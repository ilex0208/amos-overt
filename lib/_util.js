function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function MessageBus(e){var t=this;this.name=e,this.messageMap={},this.messageCount=0,this.subscribe=function(e,n){var a=t.messageMap[e];null==a&&(t.messageMap[e]=[]),t.messageMap[e].push(n),t.messageCount++},this.unsubscribe=function(e){var n=t.messageMap[e];n&&null!=n&&(t.messageMap[e]=null,delete t.messageMap[e],t.messageCount--)},this.publish=function(e,n,a){var r=t.messageMap[e];if(null!=r)for(var o=0;o<r.length;o++)a?!function(e,t){setTimeout(function(){e(t)},10)}(r[o],n):r[o](n)}}function getDistance(e,t,n,a){var r=void 0,o=void 0;return null==n&&null==a?(r=t.x-e.x,o=t.y-e.y):(r=n-e,o=a-t),Math.sqrt(r*r+o*o)}function mouseCoords(e){return e=cloneEvent(e),e.pageX||(e.pageX=e.clientX+document.body.scrollLeft-document.body.clientLeft,e.pageY=e.clientY+document.body.scrollTop-document.body.clientTop),e}function getEventPosition(e){return e=mouseCoords(e)}function rotatePoint(e,t,n,a,r){var o=n-e,i=a-t,s=Math.sqrt(o*o+i*i),l=Math.atan2(i,o)+r;return{x:e+Math.cos(l)*s,y:t+Math.sin(l)*s}}function rotatePoints(e,t,n){for(var a=[],r=0;r<t.length;r++){var o=rotatePoint(e.x,e.y,t[r].x,t[r].y,n);a.push(o)}return a}function _foreach(e,t,n){function a(r){r!=e.length&&(t(e[r]),setTimeout(function(){a(++r)},n))}if(0!=e.length){var r=0;a(r)}}function _for(e,t,n,a){function r(e){e!=t&&(n(t),setTimeout(function(){r(++e)},a))}if(!(t<e)){var o=0;r(o)}}function cloneEvent(e){var t={};for(var n in e)"returnValue"!=n&&"keyLocation"!=n&&(t[n]=e[n]);return t}function clone(e){var t={};for(var n in e)t[n]=e[n];return t}function isPointInRect(e,t){var n=t.x,a=t.y,r=t.width,o=t.height;return e.x>n&&e.x<n+r&&e.y>a&&e.y<a+o}function isPointInLine(e,t,n){var a=getDistance(t,n),r=getDistance(t,e),o=getDistance(n,e),i=Math.abs(r+o-a)<=.5;return i}function removeFromArray(e,t){for(var n=0;n<e.length;n++){var a=e[n];if(a===t){e=e.del(n);break}}return e}function randomColor(){return Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())}function isIntsect(){}function getProperties(e,t){for(var n="",a=0;a<t.length;a++){a>0&&(n+=",");var r=e[t[a]];"string"==typeof r?r='"'+r+'"':void 0==r&&(r=null),n+=t[a]+":"+r}return n}function toJson(e){var t="backgroundColor,visible,mode,rotate,alpha,scaleX,scaleY,shadow,translateX,translateY,areaSelect,paintAll".split(","),n="text,elementType,x,y,width,height,visible,alpha,rotate,scaleX,scaleY,fillColor,shadow,transformAble,zIndex,dragable,selected,showSelected,font,fontColor,textPosition,textOffsetX,textOffsetY".split(","),a="{";a+="frames:"+e.frames,a+=", scenes:[";for(var r=0;r<e.childs.length;r++){var o=e.childs[r];a+="{",a+=getProperties(o,t),a+=", elements:[";for(var i=0;i<o.childs.length;i++){var s=o.childs[i];i>0&&(a+=","),a+="{",a+=getProperties(s,n),a+="}"}a+="]}"}return a+="]",a+="}"}function generateColor(e,t,n){var a=n.split(","),r=parseInt(a[0]),o=parseInt(a[1]),i=parseInt(a[2]),s=targetCanvas.width=t.width,l=targetCanvas.height=t.height;e.clearRect(0,0,targetCanvas.width,targetCanvas.height),e.drawImage(t,0,0);for(var c=e.getImageData(0,0,t.width,t.height),g=c.data,u=0;u<s;u++)for(var h=0;h<l;h++){var f=4*(u+h*s);0!=g[f+3]&&(null!=r&&(g[f+0]+=r),null!=o&&(g[f+1]+=o),null!=i&&(g[f+2]+=i))}e.putImageData(c,0,0,0,0,t.width,t.height);var m=targetCanvas.toDataURL();return m}function generateImageAlarm(e,t){var n=e.src+t;try{if(alarmImageCache[n])return alarmImageCache[n];var a=new Image;return a.src=generateColor(graphics,e,t),alarmImageCache[n]=a,a}catch(e){console.log("genImageAlarm error|@",e)}return null}function changeColor(e,t,n,a,r,o){var i=targetCanvas.width=t.width,s=targetCanvas.height=t.height;e.clearRect(0,0,targetCanvas.width,targetCanvas.height),e.drawImage(t,0,0);for(var l=e.getImageData(0,0,t.width,t.height),c=l.data,g=0;g<i;g++)for(var u=0;u<s;u++){var h=4*(g+u*i);0!=c[h+3]&&(null!=n&&(c[h+0]+=n),null!=a&&(c[h+1]+=a),null!=r&&(c[h+2]+=r))}e.putImageData(l,0,0,0,0,t.width,t.height);var f=targetCanvas.toDataURL();return alarmImageCache[t.src]=f,f}function changeColorByOpts(e,t,n){var a=(0,_assign2.default)(alarmDefaulOps,n),r=a.rgbR,o=a.rgbG,i=a.rgbB,s=a.rgbA;targetCanvas.width=t.width,targetCanvas.height=t.height,e.clearRect(0,0,targetCanvas.width,targetCanvas.height),e.drawImage(t,0,0);for(var l=e.getImageData(0,0,t.width,t.height),c=l.data,g=0;g<c.length;g+=4)0!=c[g+3]&&(null!=r&&(c[g+0]+=r),null!=o&&(c[g+1]+=o),null!=i&&(c[g+2]+=i),c[g+3]=s);e.putImageData(l,0,0,0,0,t.width,t.height);var u=targetCanvas.toDataURL();return alarmImageCache[t.src]=u,u}function genImageAlarm(e,t){t=t||255;try{if(alarmImageCache[e.src])return alarmImageCache[e.src];var n=new Image;return n.src=changeColor(graphics,e,t),alarmImageCache[e.src]=n,n}catch(e){console.log("genImageAlarm error|@",e)}return null}function genImageAlarmByOpts(e,t){var n=(0,_assign2.default)(alarmDefaulOps,t);try{if(alarmImageCache[e.src])return alarmImageCache[e.src];var a=new Image;return a.src=changeColorByOpts(graphics,e,n.rgbR),alarmImageCache[e.src]=a,a}catch(e){console.log("genImageAlarmByOpts error|@",e)}return null}function getOffsetPosition(e){if(!e)return{left:0,top:0};var t=0,n=0;if("getBoundingClientRect"in document.documentElement){var a=e.getBoundingClientRect(),r=e.ownerDocument,o=r.body,i=r.documentElement,s=i.clientTop||o.clientTop||0,l=i.clientLeft||o.clientLeft||0;t=a.top+(self.pageYOffset||i&&i.scrollTop||o.scrollTop)-s,n=a.left+(self.pageXOffset||i&&i.scrollLeft||o.scrollLeft)-l}else do t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;while(e);return{left:n,top:t}}function lineF(e,t,n,a){function r(e){return e*o+i}var o=(a-t)/(n-e),i=t-e*o;return r.k=o,r.b=i,r.x1=e,r.x2=n,r.y1=t,r.y2=a,r}function inRange(e,t,n){var a=Math.abs(t-n),r=Math.abs(t-e),o=Math.abs(n-e),i=Math.abs(a-(r+o));return 1e-6>i}function isPointInLineSeg(e,t,n){return inRange(e,n.x1,n.x2)&&inRange(t,n.y1,n.y2)}function intersection(e,t){var n=void 0,a=void 0;return e.k==t.k?null:(1/0==e.k||e.k==-1/0?(n=e.x1,a=t(e.x1)):1/0==t.k||t.k==-1/0?(n=t.x1,a=e(t.x1)):(n=(t.b-e.b)/(e.k-t.k),a=e(n)),0==isPointInLineSeg(n,a,e)?null:0==isPointInLineSeg(n,a,t)?null:{x:n,y:a})}function intersectionLineBound(e,t){var n=lineF(t.left,t.top,t.left,t.bottom),a=intersection(e,n);return null==a&&(n=lineF(t.left,t.top,t.right,t.top),a=intersection(e,n),null==a&&(n=lineF(t.right,t.top,t.right,t.bottom),a=intersection(e,n),null==a&&(n=lineF(t.left,t.bottom,t.right,t.bottom),a=intersection(e,n)))),a}var _assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),targetCanvas=document.createElement("canvas"),graphics=targetCanvas.getContext("2d"),alarmImageCache={},alarmDefaulOps={rgbR:255,rgbA:255},isFirefox=navigator.userAgent.indexOf("Firefox")>0,isIE=!(!window.attachEvent||-1!==navigator.userAgent.indexOf("Opera")),isChrome=null!=navigator.userAgent.toLowerCase().match(/chrome/);requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/24)}}(),Array.prototype.del=function(e){if("number"!=typeof targetObj){for(var t=0;t<this.length;t++)if(this[t]===e)return this.slice(0,t).concat(this.slice(t+1,this.length));return this}return e<0?this:this.slice(0,e).concat(this.slice(e+1,this.length))},[].indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),window.console||(window.console={log:function(e){},info:function(e){},debug:function(e){},warn:function(e){},error:function(e){}}),module.exports={MessageBus:MessageBus,rotatePoint:rotatePoint,rotatePoints:rotatePoints,getDistance:getDistance,getEventPosition:getEventPosition,mouseCoords:mouseCoords,isFirefox:isFirefox,isIE:isIE,isChrome:isChrome,clone:clone,isPointInRect:isPointInRect,isPointInLine:isPointInLine,removeFromArray:removeFromArray,cloneEvent:cloneEvent,randomColor:randomColor,isIntsect:isIntsect,toJson:toJson,genImageAlarm:genImageAlarm,genImageAlarmByOpts:genImageAlarmByOpts,generateImageAlarm:generateImageAlarm,getOffsetPosition:getOffsetPosition,lineF:lineF,intersection:intersection,intersectionLineBound:intersectionLineBound,_foreach:_foreach,_for:_for};