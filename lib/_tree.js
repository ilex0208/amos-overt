function _InvokeTreePane(e,t,n){this.__divPool=new Pool("div",20),this.__imagePool=new Pool("img",20),this.__canvasPool=new Pool("canvas",20),this.__spanPool=new Pool("span",20),this.__textPool=new Pool("span",20),this.treePane=e,this.treeDatas=buildTreeData(t,n),this.width="200px",this.paintTree=function(){var t=this,n=_rowHeight-_rowLineWidth-2+"px",i=_rowLineWidth+"px";this.treeDatas.forEach(function(o,l){var a=html.createDiv(),r=a.style;r.position="absolute",r.whiteSpace="nowrap",r.lineHeight=n,0!==l&&(r.top=l*_rowHeight+"px"),r.borderStyle="solid",r.borderWidth="0px",r.borderBottomWidth=i,r.borderBottomColor=_rowLineColor,r.height="19px",r.width=t.width,0===o.level?(a.appendChild(_boolSpan(!0)),a.appendChild(_boolImg())):a.appendChild(_boolSpan(!1)),_addIcon2(a,o,o.icon);var s=html.createSpan();s.style.margin="0",s.style.padding="1px 2px",s.style.whiteSpace="nowrap",s.style.verticalAlign="middle",s.innerHTML=o.name,a.appendChild(s),e.appendChild(a),initItemEvent(a)})},this.initTreeView=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.rootView=e;var n=e.clientWidth||_clientWidth,i=e.clientHeight||_clientHeight,o=t.top,l=t.right,a=t.bottom,r=t.left;this.treePane.style.position="absolute",null!=r&&(this.treePane.style.left=r+"px"),null!=o&&(this.treePane.style.top=o+"px"),null!=l&&(this.treePane.style.right=l+"px"),null!=a&&(this.treePane.style.bottom=a+"px"),this.treePane.style.width=n-innerSpace+"px",this.treePane.style.height=i-innerSpace+"px",e.appendChild(this.treePane)},this.updateTreeView=function(e){this.treeDatas=buildTreeData(e),this.paintTree()},this.paintTree()}function _boolSpan(e){var t=html.createSpan();return t.style.margin="0",t.style.padding="0",t.style.width=e?"0":"32px",t.style.display="inline-block",t}function _boolImg(){var e=html.createImg(_cons.UNEXPAND);return e.style.margin="0",e.style.padding="0",e.style.verticalAlign="middle",e}function buildTreeData(e,t){var n=[];if(e){var i=t?{name:t||"Root",icon:rootIcon(),level:0,eleId:e.getId(),elementType:"root"}:{icon:rootIcon(),level:0,eleId:e.getId(),elementType:"root"};n.push(i),e.childs&&e.childs.forEach(function(e,t){e instanceof Container&&n.push({name:e.text||"   ",icon:e.icon||defaultIcon(),level:1,eleId:e.getId(),elementType:e.elementType,alarmColor:e.alarmColor}),e instanceof Node&&n.push({name:e.text||"Node",icon:e.icon||defaultIcon(),level:2,eleId:e.getId(),elementType:e.elementType,alarmColor:e.alarmColor})})}return n}function _addIcon2(e,t,n,i){var o=html.createCanvas(),l=t.alarmColor;if(n){var a=n.width,r=n.height;o.style.verticalAlign="middle",o.setAttribute("width",a),o.setAttribute("height",r);var s=o.getContext("2d");s.clearRect(0,0,a,r),s.drawImage(n,0,0,a,r),l&&(s.fillStyle=canvasUtil.createRadialGradient(s,l,"white",1,r-9,8,8,.75,.25),s.beginPath(),s.arc(5,r-5,4,0,2*Math.PI,!0),s.closePath(),s.fill())}else o=this.__imagePool.get(),o.style.verticalAlign="middle",o.setAttribute("src",t.getImageSrc(i));return o.style.margin="0px 1px 0px 1px",e.appendChild(o),e}var Container=require("./_container"),_n=require("./_node"),Node=_n.Node,third=require("./_third"),Pool=third.Pool,html=third.html,canvasUtil=third.canvasUtil,Constants=third.Constants,UserAgent=third.UserAgent,_cons=require("./constants"),Bd=Constants.Bd,_indent=Bd.TREE_INDENT,_rowHeight=Bd.TREE_ROW_HEIGHT,_rowLineWidth=Bd.TREE_ROW_LINE_WIDTH,_rowLineColor=Bd.TREE_ROW_LINE_COLOR,_makeVisibleOnSelected=Bd.TREE_MAKE_VISIBLE_ON_SELECTED,_keyboardRemoveEnabled=Bd.TREE_KEYBOARD_REMOVE_ENABLED,_keyboardSelectEnabled=Bd.TREE_KEYBOARD_SELECT_ENABLED,_expandIcon=Bd.TREE_EXPAND_ICON,_collapseIcon=Bd.TREE_COLLAPSE_ICON,_clientWidth=200,_clientHeight=550,innerSpace=5,rootIcon=function(){var e=new Image;return e.src=_cons.ROOT_ICON,e},defaultIcon=function(){var e=new Image;return e.src=_cons.DEFAULT_ICON,e},initItemEvent=function(e){var t=this;e.addEventListener("change",function(e){t.handleChange(e)},!1),new basicInteraction(this)},basicInteraction=function(e){this.view=e;var t=this;this.view.addEventListener("scroll",function(e){t.handleScroll(e)},!1),this.view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),this.view.addEventListener("keydown",function(e){t.handleKeyDown(e)},!1),this.handleMouseDown=function(e){},this.handleKeyDown=function(e){var t=this.treeItem;if(!t._currentEditor)if(isCtrlDown(e)&&65==e.keyCode)t.isKeyboardSelectEnabled()&&t.selectAll().size()>0&&t.fireInteractionEvent({kind:"selectAll"}),html.preventDefault(e);else if(46==e.keyCode)t.isKeyboardRemoveEnabled()&&t.removeSelection()&&t.fireInteractionEvent({kind:"removeElement"}),html.preventDefault(e);else if(t.isCheckMode()||38!==e.keyCode&&40!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode);else{var n=t.getSelectionModel().getLastData();if(n)if(38===e.keyCode||40===e.keyCode){var i=t.getRowDatas(),o=t.getRowIndexByData(n);o>=0&&(38===e.keyCode?0!==o&&(n=i.get(o-1),t.getSelectionModel().setSelection(n)):o!==i.size()-1&&(n=i.get(o+1),t.getSelectionModel().setSelection(n)))}else t.expand&&(37===e.keyCode||39===e.keyCode)&&n.hasChildren()&&(37===e.keyCode?t.collapse(n):t.expand(n));else t.getRowDatas().size()>0&&(n=t.getRowDatas().get(0),t.getSelectionModel().setSelection(n))}},this.handleScroll=function(e){}},TreeItem=function(e){this.__divPool=new Pool("div",20),this.__imagePool=new Pool("img",20),this.__canvasPool=new Pool("canvas",20),this.__spanPool=new Pool("span",20),this.__textPool=new Pool("span",20),this._view=html.createView("auto"),this._rootDiv=html.createDiv(),this._view.appendChild(this._rootDiv);var t=this;t.handleChange&&t._view.addEventListener("change",function(e){t.handleChange(e)},!1);var n;n=UserAgent.isMSToucheable?TreeItemMSTouchInteraction:UserAgent.isTouchable?TreeItemTouchInteraction:TreeItemInteraction,n&&new n(this)},TreeItemMSTouchInteraction=function(){},TreeItemTouchInteraction=function(){},TreeItemInteraction=function(e){this.listBase=e,this.view=e._view;var t=this;this.view.addEventListener("scroll",function(e){t.handleScroll(e)},!1),this.view.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),this.view.addEventListener("keydown",function(e){t.handleKeyDown(e)},!1),this.handleMouseDown=function(e){var t=this.listBase;e.target!==t._currentEditor&&e.target.parentNode!==t._currentEditor&&t._handleClick(e)},this.handleKeyDown=function(e){var t=this.listBase;if(!t._currentEditor)if(isCtrlDown(e)&&65==e.keyCode)t.isKeyboardSelectEnabled()&&t.selectAll().size()>0&&t.fireInteractionEvent({kind:"selectAll"}),html.preventDefault(e);else if(46==e.keyCode)t.isKeyboardRemoveEnabled()&&t.removeSelection()&&t.fireInteractionEvent({kind:"removeElement"}),html.preventDefault(e);else if(t.isCheckMode()||38!==e.keyCode&&40!==e.keyCode&&37!==e.keyCode&&39!==e.keyCode);else{var n=t.getSelectionModel().getLastData();if(n)if(38===e.keyCode||40===e.keyCode){var i=t.getRowDatas(),o=t.getRowIndexByData(n);o>=0&&(38===e.keyCode?0!==o&&(n=i.get(o-1),t.getSelectionModel().setSelection(n)):o!==i.size()-1&&(n=i.get(o+1),t.getSelectionModel().setSelection(n)))}else t.expand&&(37===e.keyCode||39===e.keyCode)&&n.hasChildren()&&(37===e.keyCode?t.collapse(n):t.expand(n));else t.getRowDatas().size()>0&&(n=t.getRowDatas().get(0),t.getSelectionModel().setSelection(n))}},this.handleScroll=function(e){}},isCtrlDown=function(e){return e.ctrlKey||e.metaKey},isShiftDown=function(e){return e.shiftKey},isAltDown=function(e){return e.altKey},AmostTree=_InvokeTreePane;module.exports=AmostTree;