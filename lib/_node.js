function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function AbstractNode(t){this.initialize=function(t){AbstractNode.prototype.initialize.apply(this,arguments),this.elementType="node",this.zIndex=Tobj.zIndex_Node,this.text=t,this.font="12px Consolas",this.fontColor="255,255,255",this.borderWidth=0,this.borderColor="255,255,255",this.borderRadius=null,this.dragable=!0,this.textPosition="Bottom_Center",this.textOffsetX=0,this.textOffsetY=0,this.transformAble=!0,this.inLinks=null,this.outLinks=null;var i="text,font,fontColor,textPosition,textOffsetX,textOffsetY,borderRadius".split(",");this.serializedProperties=this.serializedProperties.concat(i)},this.initialize(t),this.paint=function(t){if(this.image){var i=t.globalAlpha;t.globalAlpha=this.alpha,null!=this.alarmImage&&null!=this.alarm?t.drawImage(this.alarmImage,-this.width/2,-this.height/2,this.width,this.height):t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),t.globalAlpha=i}else t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2,-this.height/2,this.width,this.height):t.AmostRoundRect(-this.width/2,-this.height/2,this.width,this.height,this.borderRadius),t.fill(),t.closePath();this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.paintAlarmText=function(t){if(null!=this.alarm&&""!=this.alarm){var i=this.alarmColor||"255,0,0",e=this.alarmAlpha||.5;t.beginPath(),t.font=this.alarmFont||"10px 微软雅黑";var h=t.measureText(this.alarm).width+6,s=t.measureText("田").width+6,a=this.width/2-h/2,o=-this.height/2-s-8;t.strokeStyle="rgba("+i+", "+e+")",t.fillStyle="rgba("+i+", "+e+")",t.lineCap="round",t.lineWidth=1,t.moveTo(a,o),t.lineTo(a+h,o),t.lineTo(a+h,o+s),t.lineTo(a+h/2+6,o+s),t.lineTo(a+h/2,o+s+8),t.lineTo(a+h/2-6,o+s),t.lineTo(a,o+s),t.lineTo(a,o),t.fill(),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.alarm,a+2,o+s-4),t.closePath()}},this.paintText=function(t){var i=this.text;if(null!=i&&""!=i){t.beginPath(),t.font=this.font;var e=t.measureText(i).width,h=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")";var s=this.getTextPostion(this.textPosition,e,h);t.fillText(i,s.x,s.y),t.closePath()}},this.paintBorder=function(t){if(0!=this.borderWidth){t.beginPath(),t.lineWidth=this.borderWidth,t.strokeStyle="rgba("+this.borderColor+","+this.alpha+")";var i=this.borderWidth/2;null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2-i,-this.height/2-i,this.width+this.borderWidth,this.height+this.borderWidth):t.AmostRoundRect(-this.width/2-i,-this.height/2-i,this.width+this.borderWidth,this.height+this.borderWidth,this.borderRadius),t.stroke(),t.closePath()}},this.getTextPostion=function(t,i,e){var h=null;return null==t||"Bottom_Center"==t?h={x:-this.width/2+(this.width-i)/2,y:this.height/2+e}:"Top_Center"==t?h={x:-this.width/2+(this.width-i)/2,y:-this.height/2-e/2}:"Top_Right"==t?h={x:this.width/2,y:-this.height/2-e/2}:"Top_Left"==t?h={x:-this.width/2-i,y:-this.height/2-e/2}:"Bottom_Right"==t?h={x:this.width/2,y:this.height/2+e}:"Bottom_Left"==t?h={x:-this.width/2-i,y:this.height/2+e}:"Middle_Center"==t?h={x:-this.width/2+(this.width-i)/2,y:e/2}:"Middle_Right"==t?h={x:this.width/2,y:e/2}:"Middle_Left"==t&&(h={x:-this.width/2-i,y:e/2}),null!=this.textOffsetX&&(h.x+=this.textOffsetX),null!=this.textOffsetY&&(h.y+=this.textOffsetY),h},this.setImage=function(t,i){if(null==t)throw new Error("Node.setImage(): 参数Image对象为空!");var e=this;if("string"==typeof t){var h=imageCache[t];null==h?(h=new Image,h.src=t,h.onload=function(){imageCache[t]=h,!0===i&&e.setSize(h.width,h.height),e.image=h,e.alarmColor=null==e.alarmColor?"255,0,0":e.alarmColor}):(i&&this.setSize(h.width,h.height),e.image=h,e.alarmColor=null==e.alarmColor?"255,0,0":e.alarmColor)}else this.image=t,e.alarmColor=null==e.alarmColor?"255,0,0":e.alarmColor,!0===i&&this.setSize(t.width,t.height)},this.setImageByOpts=function(t,i,e){var h=this;if(null==t)throw new Error("Node.setImage(): 参数Image对象为空!");var s=this;"string"==typeof t?!function(){var a=imageCache[t];null==a?(a=new Image,a.src=t,a.onload=function(){imageCache[t]=a,!0===i&&s.setSize(a.width,a.height);var h=Util.genImageAlarmByOpts(a,e);h&&(a.alarm=h),s.image=a}):(i&&h.setSize(a.width,a.height),h.image=a)}():(this.image=t,!0===i&&this.setSize(t.width,t.height))},this.removeHandler=function(t){var i=this;this.outLinks&&(this.outLinks.forEach(function(e){e.nodeA===i&&t.remove(e)}),this.outLinks=null),this.inLinks&&(this.inLinks.forEach(function(e){e.nodeZ===i&&t.remove(e)}),this.inLinks=null)}}function Node(){Node.prototype.initialize.apply(this,arguments)}function TextNode(t){this.initialize(),this.text=t,this.elementType="TextNode",this.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.text,-this.width/2,this.height/2),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)}}function LinkNode(t,i,e){this.initialize(),this.text=t,this.href=i,this.target=e,this.elementType="LinkNode",this.isVisited=!1,this.visitedColor=null,this.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,this.isVisited&&null!=this.visitedColor?(t.strokeStyle="rgba("+this.visitedColor+", "+this.alpha+")",t.fillStyle="rgba("+this.visitedColor+", "+this.alpha+")"):(t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")"),t.fillText(this.text,-this.width/2,this.height/2),this.isMouseOver&&(t.moveTo(-this.width/2,this.height),t.lineTo(this.width/2,this.height),t.stroke()),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.mousemove(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var i=0;i<t.length;i++)t[i].style.cursor="pointer"}),this.mouseout(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var i=0;i<t.length;i++)t[i].style.cursor="default"}),this.click(function(){"_blank"==this.target?window.open(this.href):location=this.href,this.isVisited=!0})}function CircleNode(t){this.initialize(arguments),this._radius=20,this.beginDegree=0,this.endDegree=2*Math.PI,this.text=t,this.paint=function(t){t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",t.arc(0,0,this.radius,this.beginDegree,this.endDegree,!0),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.paintSelected=function(t){t.save(),t.beginPath(),t.strokeStyle="rgba(168,202,255, 0.9)",t.fillStyle="rgba(168,202,236,0.7)",t.arc(0,0,this.radius+3,this.beginDegree,this.endDegree,!0),t.fill(),t.stroke(),t.closePath(),t.restore()}}function DefaultAnimateNode(t,i,e){this.initialize(),this.frameImages=t||[],this.frameIndex=0,this.isStop=!0;var h=i||1e3;this.repeatPlay=!1;var s=this;this.nextFrame=function(){if(!this.isStop&&null!=this.frameImages.length){if(this.frameIndex++,this.frameIndex>=this.frameImages.length){if(!this.repeatPlay)return;this.frameIndex=0}this.setImage(this.frameImages[this.frameIndex],e),setTimeout(function(){s.nextFrame()},h/t.length)}}}function CustomAnimateNode(t,i,e,h,s){this.initialize();var a=this;this.setImage(t),this.frameIndex=0,this.isPause=!0,this.repeatPlay=!1;var o=h||1e3;s=s||0,this.paint=function(t){if(this.image){var i=this.width,h=this.height;t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")";var a=(Math.floor(this.frameIndex/e)+s)*h,o=Math.floor(this.frameIndex%e)*i;t.drawImage(this.image,o,a,i,h,-i/2,-h/2,i,h),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)}},this.nextFrame=function(){if(!this.isStop){if(this.frameIndex++,this.frameIndex>=i*e){if(!this.repeatPlay)return;this.frameIndex=0}setTimeout(function(){a.isStop||a.nextFrame()},o/(i*e))}}}function AnimateNode(){var t=null;return t=arguments.length<=3?new DefaultAnimateNode(arguments[0],arguments[1],arguments[2]):new CustomAnimateNode(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),t.stop=function(){t.isStop=!0},t.play=function(){t.isStop=!1,t.frameIndex=0,t.nextFrame()},t}var _defineProperties=require("babel-runtime/core-js/object/define-properties"),_defineProperties2=_interopRequireDefault(_defineProperties),Tobj=require("./_tobj"),_e=require("./_baseElement"),Util=require("./_util"),EditableElement=_e.EditableElement,imageCache={};AbstractNode.prototype=new EditableElement,Node.prototype=new AbstractNode,(0,_defineProperties2.default)(Node.prototype,{alarmColor:{get:function(){return this._alarmColor},set:function(t){if(this._alarmColor=t,null!=this.image){var i=Util.generateImageAlarm(this.image,t);i&&(this.alarmImage=i)}}}}),TextNode.prototype=new Node,LinkNode.prototype=new TextNode,CircleNode.prototype=new Node,(0,_defineProperties2.default)(CircleNode.prototype,{radius:{get:function(){return this._radius},set:function(t){this._radius=t;var i=2*this.radius,e=2*this.radius;this.width=i,this.height=e}},width:{get:function(){return this._width},set:function(t){this._radius=t/2,this._width=t}},height:{get:function(){return this._height},set:function(t){this._radius=t/2,this._height=t}}}),DefaultAnimateNode.prototype=new Node,CustomAnimateNode.prototype=new Node,AnimateNode.prototype=new Node,module.exports={Node:Node,TextNode:TextNode,LinkNode:LinkNode,CircleNode:CircleNode,AnimateNode:AnimateNode};