var _tool=require("./../common/_tool"),List=require("./_list"),Position=require("./_position"),math={getDistance:function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},getCenterPoint:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},isPointInPolygon:function(t,e){t=t._as;var n=0,r=0,a=!1,i=t.length;for(n=0,r=i-1;n<i;r=n++){var h=t[n],o=t[r];h.y>e.y!=o.y>e.y&&e.x<(o.x-h.x)*(e.y-h.y)/(o.y-h.y)+h.x&&(a=!a)}return a},unionRect:function(t,e){if(t&&!e)return _tool.clone(t);if(!t&&e)return _tool.clone(e);if(t&&e){var n={};return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n.width=Math.max(t.x+t.width,e.x+e.width)-n.x,n.height=Math.max(t.y+t.height,e.y+e.height)-n.y,n}return null},intersects:function(t,e){if(!t||!e)return!1;var n=e.width,r=e.height,a=t.width,i=t.height;if(a<=0||i<=0||n<=0||r<=0)return!1;var h=e.x,o=e.y,u=t.x,y=t.y;return a+=u,i+=y,n+=h,r+=o,(a<u||a>h)&&(i<y||i>o)&&(n<h||n>u)&&(r<o||r>y)},intersection:function(t,e){if(!t||!e)return!1;var n=e.x,r=e.y,a=t.x,i=t.y,h=n;h+=e.width;var o=r;o+=e.height;var u=a;u+=t.width;var y=i;return y+=t.height,n<a&&(n=a),r<i&&(r=i),h>u&&(h=u),o>y&&(o=y),h-=n,o-=r,0===h||0===o?null:{x:n,y:r,width:h,height:o}},contains:function(t,e){var n=e.x,r=e.y,a=e.width,i=e.height,h=t.width,o=t.height;if((h|o|a|i)<0)return!1;var u=t.x,y=t.y;if(n<u||r<y)return!1;if(h+=u,a+=n,a<=n){if(h>=u||a>h)return!1}else if(h>=u&&a>h)return!1;if(o+=y,i+=r,i<=r){if(o>=y||i>o)return!1}else if(o>=y&&i>o)return!1;return!0},getLinePoints:function(t){if(!t)return null;var e=new List;return t.forEach(function(t){e.addAll(t)}),e},getLineRect:function(t){var e=math.getLinePoints(t);return math.getRect(e)},getRect:function(t,e){if(!t)return null;t._as&&(t=t._as);var n=t.length;if(n<=0)return null;var r=t[0];e=e||{x:r.x,y:r.y,width:0,height:0};for(var a=1;a<n;a++)if(r=t[a],r instanceof List)math.getRect(r,e);else{var i=Math.min(e.x,r.x),h=Math.max(e.x+e.width,r.x),o=Math.min(e.y,r.y),u=Math.max(e.y+e.height,r.y);e.x=i,e.y=o,e.width=h-i,e.height=u-o}return e},addPadding:function(t,e,n,r){3===arguments.length&&(r=-1);var a=e.getStyle(n)*r;0!=a&&math.grow(t,a,a),a=e.getStyle(n+".left")*r,0!=a&&(t.x-=a,t.width+=a),a=e.getStyle(n+".right")*r,0!=a&&(t.width+=a),a=e.getStyle(n+".top")*r,0!=a&&(t.y-=a,t.height+=a),a=e.getStyle(n+".bottom")*r,0!=a&&(t.height+=a),t.width<0&&(t.width=-t.width,t.x-=t.width),t.height<0&&(t.height=-t.height,t.y-=t.height)},grow:function(t,e,n){var r=t.width+e+e;if(!(r<0)){var a=t.height+n+n;a<0||(t.x-=e,t.y-=n,t.width=r,t.height=a)}},containsPoint:function(t,e,n){return arguments.length<3&&(n=e.y,e=e.x),!(!t||e<t.x||n<t.y||e>t.x+t.width||n>t.y+t.height)},getHotSpot:function(t,e,n,r,a){if("oval"===a){var i=.35;return{x:t+.5*n+n*i,y:e+r/2-Math.sqrt(.25-i*i)*r}}if("circle"===a){var h=t+n/2,o=e+r/2,u=Math.min(n,r)/2;t=h-u,e=o-u,n=2*u,r=2*u;var y=n/2,c=r/2,f=y*c/Math.sqrt(y*y+c*c);return{x:t+n/2+f,y:e+r/2-f}}var x={x:t+n,y:e};return n>3&&(x.x-=3),r>3&&(x.y+=3),x},getCircleRect:function(t){var e=Math.min(t.width,t.height)/2;return{x:t.x+t.width/2-e,y:t.y+t.height/2-e,width:2*e,height:2*e}},getEllipsePoint:function(t,e){if(!t||!e)return null;var n=t.x+t.width/2,r=t.y+t.height/2,a=e.x-n,i=e.y-r,h=t.width/2,o=t.height/2,u=Math.sqrt(1/(1/h/h+i*i/a/a/o/o));a<0&&(u=-u);var y;return y=0==a?i>0?o:-o:u*i/a,{x:n+u,y:r+y}},createMatrix:function(t,e,n){var r=Math.sin(t),a=Math.cos(t),i=e*(1-a)+n*r,h=n*(1-a)-e*r;return new Position(a,r,(-r),a,i,h)},reversePath:function(t){var e,n=new List,r=null;t._as&&(t=t._as);for(var a=t.length-1;a>=0;a--)e=t[a],n.add(math._getReversePath(e,r)),r=e;return n},_getPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-1]:t},_getControlPoint:function(t){return t._as&&(t=t._as),t instanceof Array?t[t.length-2]:t},_getReversePath:function(t,e){var n=math._getPoint(t);return e&&e._as&&(e=e._as),null!=e&&e instanceof Array?new List(2==e.length?[e[0],n]:[e[1],e[0],n]):n},_getLength:function(t,e){var n=math._getPoint(e),r=math._getPoint(t);if(t instanceof List&&(t=t._as),t instanceof Array)return math.calculateCurveLength(n,t,1);var a=r.y-n.y,i=r.x-n.x;return Math.sqrt(i*i+a*a)},getPathInfo:function(t,e,n,r,a){var i,h=math._getPoint(e),o=math._getPoint(t);if(t instanceof List&&(t=t._as),t instanceof Array){a<0&&(a=math._getLength(t,e));var u=n/a,y=math.calculatePointInfoOnCurveLine(h,t,u);h=y.point,i=y.angle,n=0}else i=Math.atan2(o.y-h.y,o.x-h.x);return math.transformPoint(h,i,n,r)},transformPoint:function(t,e,n,r){var a={x:n,y:r},i=math.createMatrix(e,0,0);return a=i.transform(a),a.x+=t.x,a.y+=t.y,{point:a,angle:e}},calculatePointInfoOnStraightLine:function(t,e,n,r){var a=Math.atan2(e.y-t.y,e.x-t.x);return math.transformPoint(t,a,n,r)},calculatePointInfoOnCurveLine:function(t,e,n){if(n<0||n>1)throw"Illegal arguments";return e._as&&(e=e._as),2==e.length?math._calculatePointInfoOnCurveLine2(t,e[0],e[1],n):math._calculatePointInfoOnCurveLine3(t,e[0],e[1],e[2],n)},_calculatePointInfoOnCurveLine2:function(t,e,n,r){var a=2*(t.x+n.x-2*e.x)*r+2*e.x-2*t.x,i=2*(t.y+n.y-2*e.y)*r+2*e.y-2*t.y,h=Math.atan2(i,a),o=(t.x+n.x-2*e.x)*r*r+(2*e.x-2*t.x)*r+t.x,u=(t.y+n.y-2*e.y)*r*r+(2*e.y-2*t.y)*r+t.y;return{point:{x:o,y:u},angle:h}},_calculatePointInfoOnCurveLine3:function(t,e,n,r,a){var i,h,o;i=1-a,h=i*i*i,o=a*a*a;var u=h*t.x+3*a*i*i*e.x+3*a*a*i*n.x+o*r.x,y=h*t.y+3*a*i*i*e.y+3*a*a*i*n.y+o*r.y;return{point:{x:u,y:y},angle:Math.atan2(math._bezeSpeedY(t,e,n,r,a),math._bezeSpeedX(t,e,n,r,a))}},calculateCurveLength:function(t,e,n){return e._as&&(e=e._as),2==e.length?math._calculateCurveLength(t,e[0],e[1],n):math._calculateBezierCurveLength(t,e[0],e[1],e[2],n)},_calculateCurveLength:function(t,e,n,r){if(r<=0||r>1)return 0;var a=Math.floor(r*(Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))+Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)))/2),i=0;a<=0&&(a=1);for(var h,o,u=r/a,y=0,c=0;c<a;c++)y=u*c,h=2*(t.x+n.x-2*e.x)*y+2*e.x-2*t.x,o=2*(t.y+n.y-2*e.y)*y+2*e.y-2*t.y,h*=u,o*=u,i+=Math.sqrt(h*h+o*o);return i},_calculateBezierCurveLength:function(t,e,n,r,a){if(a<=0||a>1)return 0;var i=1e4,h=Math.floor(i*a);if(1==(1&h)&&h++,0==h)return 0;var o,u=Math.floor(h/2),y=0,c=0,f=a/h;for(o=0;o<u;o++)y+=math._bezeSpeed(t,e,n,r,(2*o+1)*f);for(o=1;o<u;o++)c+=math._bezeSpeed(t,e,n,r,2*o*f);return(math._bezeSpeed(t,e,n,r,0)+math._bezeSpeed(t,e,n,r,1)+2*c+4*y)*f/3},_bezeSpeedX:function(t,e,n,r,a){var i=1-a;return-3*t.x*i*i+3*e.x*i*i-6*e.x*i*a+6*n.x*i*a-3*n.x*a*a+3*r.x*a*a},_bezeSpeedY:function(t,e,n,r,a){var i=1-a;return-3*t.y*i*i+3*e.y*i*i-6*e.y*i*a+6*n.y*i*a-3*n.y*a*a+3*r.y*a*a},_bezeSpeed:function(t,e,n,r,a){var i=math._bezeSpeedX(t,e,n,r,a),h=math._bezeSpeedY(t,e,n,r,a);return Math.sqrt(i*i+h*h)},getPointObject:function(t,e){if(!e||0==e.size())return t;var n=new List;e=e._as,t=t._as;var r,a,i=0,h=e.length,o=t.length;for(r=0;r<h&&(a=e[r],i!=o);r++)"cubicto"===a?i<o-2&&n.add([t[i++],t[i++],t[i++]]):"quadto"===a?i<o-1&&n.add([t[i++],t[i++]]):i<o&&n.add(t[i++]);for(;i<o;i++)n.add(t[i]);return n},calculateLineLength:function(t,e){if(!t||t.size()<2)return 0;if(e)return math.calculateLineLength(math.getPointObject(t,e));t=t._as;var n,r,a,i,h,o,u,y=t.length,c=0;for(n=0;n<y;n++)i=t[n],0!=n?(a=i,a instanceof List&&(a=a._as),a instanceof Array?(h=math.calculateCurveLength(r,a,1),r=a[a.length-1]):(u=i.y-r.y,o=i.x-r.x,h=Math.sqrt(o*o+u*u),r=a),c+=h):r=i;return c},toDegrees:function(t){return 180*t/Math.PI},toRadians:function(t){return t/180*Math.PI},getRadiansBetweenLines:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},getAngle:function(t,e){return t.x===e.x?e.y===t.y?0:e.y>t.y?Math.PI/2:-Math.PI/2:Math.atan((e.y-t.y)/(e.x-t.x))}};module.exports=math;