var List=require("./_list"),math=require("./_math"),Position=require("./_position"),arrow={shapeMap:{},init:function(){arrow.register("arrow.standard",arrow.createStandardArrow()),arrow.register("arrow.delta",arrow.createDeltaArrow()),arrow.register("arrow.diamond",arrow.createDiamondArrow()),arrow.register("arrow.short",arrow.createShortArrow()),arrow.register("arrow.slant",arrow.createSlantArrow())},createStandardArrow:function(){var r=new List;return r.add({x:-1,y:-5/9}),r.add({x:-.75,y:0}),r.add({x:-1,y:5/9}),r.add({x:0,y:0}),r.add({x:-1,y:-5/9}),r},createDeltaArrow:function(){var r=new List;return r.add({x:-1,y:-5/9}),r.add({x:-1,y:5/9}),r.add({x:0,y:0}),r.add({x:-1,y:-5/9}),r},createDiamondArrow:function(){var r=new List;return r.add({x:-7/12,y:5/9}),r.add({x:-14/12,y:0}),r.add({x:-7/12,y:-5/9}),r.add({x:0,y:0}),r.add({x:-7/12,y:5/9}),r},createShortArrow:function(){var r=new List;return r.add({x:-8/12,y:6/9}),r.add({x:-5/12,y:0}),r.add({x:-8/12,y:-6/9}),r.add({x:0,y:0}),r.add({x:-8/12,y:6/9}),r},createSlantArrow:function(){var r=new List;return r.add({x:-1,y:-5/9}),r.add({x:-6.5/12,y:0}),r.add({x:-.75,y:4/9}),r.add({x:0,y:0}),r.add({x:-1,y:-5/9}),r},register:function(r,e){arrow.shapeMap[r]=e},getShape:function(r){if(r)return arrow.shapeMap[r];throw"shape type can't be null"},_drawArrow:function(r,e,t,a,o,n){e=e._as;var w,d,i,l=e.length,y=new List;for(i=new Position(o,0,0,n,a.x,a.y),w=0;w<l;w++)y.add(i.transform(e[w]));y=y._as,i=math.createMatrix(t+Math.PI,a.x,a.y);var f=y[0];for(f=i.transform(f),r.moveTo(f.x,f.y),w=1;w<l;w++)d=y[w],d instanceof List&&(d=d._as),d instanceof Array?(d[0]=i.transform(d[0]),d[1]=i.transform(d[1]),r.quadraticCurveTo(d[0].x,d[0].y,d[1].x,d[1].y)):(d=i.transform(d),r.lineTo(d.x,d.y))},drawLinkArrow:function(r,e,t){t.size()<2||(r._element.getStyle("arrow.from")&&arrow._drawFromArrow(r,e,t),r._element.getStyle("arrow.to")&&arrow._drawToArrow(r,e,t))},_drawFromArrow:function(r,e,t){var a=r._element,o=a.getStyle("arrow.from.fill"),n=a.getStyle("arrow.from.outline.width");if(o||n>=0){var w=a.getStyle("arrow.from.width"),d=a.getStyle("arrow.from.height"),i=a.getStyle("arrow.from.xoffset");if(i>0&&i<1){var l;l=r.getLineLength?r.getLineLength():r._element.getLineLength(),i*=l}else r.getLineLength&&(i+=arrow.calculateArrowXOffsetAtEdge(t,r,!0));var y=a.getStyle("arrow.from.yoffset"),f=a.getStyle("arrow.from.shape");arrow.drawArrow(e,w,d,t,!0,f,o,a.getStyle("arrow.from.color"),i,y,n,a.getStyle("arrow.from.outline.color"))}},_drawToArrow:function(r,e,t){var a=r._element,o=a.getStyle("arrow.to.fill"),n=a.getStyle("arrow.to.outline.width");if(o||n>=0){var w=a.getStyle("arrow.to.width"),d=a.getStyle("arrow.to.height"),i=a.getStyle("arrow.to.xoffset");if(i>0&&i<1){var l;l=r.getLineLength?r.getLineLength():r._element.getLineLength(),i*=l}else r.getLineLength&&(i+=arrow.calculateArrowXOffsetAtEdge(t,r,!1));var y=a.getStyle("arrow.to.yoffset"),f=a.getStyle("arrow.to.shape");arrow.drawArrow(e,w,d,t,!1,f,o,a.getStyle("arrow.to.color"),i,y,n,a.getStyle("arrow.to.outline.color"))}}};arrow.init(),module.exports=arrow;