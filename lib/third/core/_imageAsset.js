var html=require("./_html"),ImageAsset=function t(e,i,a,h,s){this._name=e,this._width=a,this._height=h,this._svg=s,"string"==typeof i?this._src=i:"function"==typeof i?this._func=i:this._image=i,this._canvas=html.createCanvas(),this._colors={},this.getName=function(){return this._name},this.getSrc=function(){return this._src},this.getSvg=function(){return this._svg},this._getValue=function(e){var i=t._colors[e];if(null!=i)return i;var a=t._canvas;a.width=3,a.height=3;var h=a.getContext("2d");h.clearRect(0,0,3,3),h.fillStyle=e,h.beginPath(),h.rect(0,0,3,3),h.closePath(),h.fill();var s=h.getImageData(1,1,1,1).data;return i=(s[0]<<16)+(s[1]<<8)+s[2],t._colors[e]=i,i},this._getImage=function(t,e,i,a){var h=html.createCanvas(i,a),s=h.getContext("2d");s.drawImage(t,0,0,i,a);try{for(var r=s.getImageData(0,0,i,a),n=r.data,g=0,u=n.length;g<u;g+=4){var _=n[g+0],c=n[g+1],o=n[g+2],m=77*_+151*c+28*o>>8;m=m<<16|m<<8|m,m&=e,n[g+0]=m>>16&255,n[g+1]=m>>8&255,n[g+2]=255&m}s.putImageData(r,0,0)}catch(e){return t}return h},this.getImage=function(e,i,a){if(!e||!this._image)return this._image;this._map||(this._map={});var h;h=this._svg&&3===arguments.length?e+","+i+","+a:e;var s=this._map[h];if(s)return s;var r=t._getValue(e);return s=t._getImage(this._image,r,this._svg?i:this.getWidth(),this._svg?a:this.getHeight()),this._map[h]=s,s},this.getWidth=function(){return this._width},this.getHeight=function(){return this._height},this.getFunction=function(){return this._func}};module.exports=ImageAsset;