var DataBox=require("./_db"),AlarmBox=require("./_alarmBox"),EventDispatcher=require("./_eventDispatcher"),List=require("./../core/_list"),invokeExtends=require("./../core/_ext"),ElementBox=function e(t){e.superClass.constructor.apply(this,arguments),this._styleMap={},this._alarmBox=new AlarmBox(this),this._indexChangeDispatcher=new EventDispatcher,this.IStyle=!0,this.__style=1,this._name="ElementBox",this.add=function(t,n){if(t){if(!t.IElement)throw"Only IElement can be added into ElementBox";e.superClass.add.apply(this,arguments),this.adjustElementIndex(t)}},this.onDataPropertyChanged=function(t,n){e.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY[n.property]&&this.adjustElementIndex(t),e.superClass.onDataPropertyChanged.apply(this,arguments)},this.addIndexChangeListener=function(e,t,n){this._indexChangeDispatcher.add(e,t,n)},this.removeIndexChangeListener=function(e,t){this._indexChangeDispatcher.remove(e,t)},this.fireIndexChange=function(e,t,n){this._indexChangeDispatcher.fire({element:e,oldIndex:t,newIndex:n})},this.adjustElementIndex=function(e){this.contains(e)&&(e.isAdjustedToBottom()?(this.sendToBottom(e),e.getChildren().forEach(this.adjustElementIndex,this)):this.sendToTop(e))},this.forEachByLayer=function(e,t,n){var i=this.size(),r=this.getDatas();if(t)for(var a=0;a<i;a++){var s=r.get(a);if(this._layerBox.getLayerByElement(s)===t)if(n){if(e.call(n,s)===!1)return}else if(e(s)===!1)return}else this._layerBox.forEachByDepthFirst(function(t){for(var a=0;a<i;a++){var s=r.get(a);if(this._layerBox.getLayerByElement(s)===t)if(n){if(e.call(n,s)===!1)return}else if(e(s)===!1)return}},null,this)},this.forEachByLayerReverse=function(e,t,n){var i=new List;this.forEachByLayer(function(e){i.add(e,0)},t),i.forEach(e,n)},this.getLayerBox=function(){return this._layerBox},this.getAlarmBox=function(){return this._alarmBox},this.getAlarmStatePropagator=function(){return this._alarmStatePropagator}};ElementBox.IS_INTERESTED_ADJUSTELEMENTINDEX_PROPERTY={fromAgent:1,toAgent:1,expanded:1,parent:1,host:1},invokeExtends("third.ElementBox",DataBox,ElementBox),ElementBox.prototype.getClassName=function(){return"third.ElementBox"},module.exports=ElementBox;