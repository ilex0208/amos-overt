var List=require("./../core/_list"),math=require("./../core/_math"),html=require("./../core/_html"),EventDispatcher=require("./_eventDispatcher"),_third=require("./../core/_third"),_cons=require("./../constants"),Bd=_cons.Bd,SelectionModel=require("./_model"),_render=require("./../core/_render"),animate=require("./../core/_animgmt"),Pool=require("./../core/_pool"),UserAgent=require("./../core/_userAgent"),createRadialGradient=require("./../utils/canvasUtil").createRadialGradient,thirdUtil=require("./../core/_thirdUtil"),DataBox=require("./_db"),ColumnBox=require("./_ColumnBox"),PropertyChangeDispatcher=require("./_PropertyChangeDispatcher"),invokeExtends=require("./../core/_ext"),controls={};controls.ControlBase=function(){controls.ControlBase.superClass.constructor.apply(this,arguments),this._pools=new List,this.addPool=function(t){this._pools.contains(t)||this._pools.add(t)},this.removePool=function(t){this._pools.remove(t)},this.adjustBounds=function(t){var e=this._view.style;e.position="absolute",e.left=t.x+"px",e.top=t.y+"px",e.width=t.width+"px",e.height=t.height+"px",this.invalidate&&this.invalidate()},this.getView=function(){return this._view},this.invalidate=function(t){this._invalidate||(this._invalidate=!0,_third.callLater(this.validate,this,null,t))},this.validate=function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):this.validateImpl())},this.validateImpl=function(){}},invokeExtends("third.controls.ControlBase",PropertyChangeDispatcher,controls.ControlBase),controls.ControlBase.prototype.getClassName=function(){return"third.controls.ControlBase"},controls.ViewBase=function(){controls.ViewBase.superClass.constructor.apply(this,arguments),this._interactionDispatcher=new EventDispatcher,this._viewDispatcher=new EventDispatcher,this.__bool=["focusOnClick"],this._focusOnClick=Bd.FOCUS_ON_CLICK,this.getSelectionModel=function(){return this._selectionModel?this._selectionModel:this._box.getSelectionModel()},this.isShareSelectionModel=function(){return null==this._selectionModel},this.setShareSelectionModel=function(t){var e=null==this._selectionModel;e!==t&&(t?(this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel.dispose(),this._selectionModel=null):(this._box.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this),this._selectionModel=new SelectionModel(this._box),this._selectionModel.addSelectionChangeListener(this.handleSelectionChange,this)),this.onShareSelectionModelChanged(),this.firePropertyChange("shareSelectionModel",e,t))},this.removeSelection=function(){if(0===this.getSelectionModel().size())return null;var t=this.getSelectionModel().toSelection();return t.forEach(function(t){this._box.remove(t)},this),t},this.selectAll=function(){var t=new List;return this._box.forEach(function(e){this.isVisible(e)&&t.add(e)},this),this.getSelectionModel().setSelection(t),t},this.isSelected=function(t){return this.getSelectionModel().contains(t)},this.isSelectable=function(t){return this.getSelectionModel().isSelectable(t)},this.getLabel=function(t){return t.getName()},this.getToolTip=function(t){return t.getToolTip()},this.getIcon=function(t){return t.getIcon()},this.getSelectColor=function(t){return Bd.SELECT_COLOR},this.addViewListener=function(t,e,i){this._viewDispatcher.add(t,e,i)},this.removeViewListener=function(t,e){this._viewDispatcher.remove(t,e)},this.fireViewEvent=function(t){this._viewDispatcher.fire(t)},this.addInteractionListener=function(t,e,i){this._interactionDispatcher.add(t,e,i)},this.removeInteractionListener=function(t,e){this._interactionDispatcher.remove(t,e)},this.fireInteractionEvent=function(t){this._interactionDispatcher.fire(t)},this.invalidate=function(t){this._invalidate||(this._invalidate=!0,this.fireViewEvent({kind:"invalidate"}),_third.callLater(this.validate,this,null,t))},this.validate=function(){this._invalidate&&(this._invalidate=!1,0===this._view.offsetWidth&&0===this._view.offsetHeight&&null!==this._reinvalidateCount?(void 0===this._reinvalidateCount&&(this._reinvalidateCount=100),this._reinvalidateCount>0?this._reinvalidateCount--:this._reinvalidateCount=null,this.invalidate()):(this._isValidating=!0,this.fireViewEvent({kind:"validateStart"}),this.validateImpl(),this.fireViewEvent({kind:"validateEnd"}),delete this._isValidating))}},invokeExtends("third.controls.ViewBase",controls.ControlBase,controls.ViewBase),controls.ViewBase.prototype.getClassName=function(){return"third.controls.ViewBase"},controls.View=function(){controls.View.superClass.constructor.apply(this,arguments),this._zoom=1,this._maxZoom=Bd.ZOOM_MAX,this._minZoom=Bd.ZOOM_MIN,this.getRootDiv=function(){return this._rootDiv},this.isValidEvent=function(t){return html.isValidEvent(this._view,t)},this.getAlarmFillColor=function(t){if(t.IElement){var e=t.getAlarmState().getHighestNewAlarmSeverity();if(e)return e.color}return null},this.getInnerColor=function(t){if(t.IElement){var e=t.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:t.getStyle("inner.color")}return null},this.getOuterColor=function(t){if(t.IElement){var e=t.getAlarmState().getPropagateSeverity();return e?e.color:t.getStyle("outer.color")}return null},this.zoomOverview=function(t){var e=Math.min(this._view.clientWidth/this._viewRect.width,this._view.clientHeight/this._viewRect.height);this.setZoom(e,t)},this.getLogicalPoint=function(t){return html.getLogicalPoint(this._view,t,this.getZoom(),this._rootDiv)},this.centerByLogicalPoint=function(t,e,i){i&&animate.AnimateManager.endAnimate();var o=this._view.scrollWidth-this._view.clientWidth,s=this._view.scrollHeight-this._view.clientHeight,n=(t-this._view.clientWidth/this._zoom/2)*this._zoom,a=(e-this._view.clientHeight/this._zoom/2)*this._zoom;n<0&&(n=0),a<0&&(a=0),n>o&&(n=o),a>s&&(a=s),i?animate.AnimateManager.start(new animate.AnimateScrollPosition(this._view,n,a)):(this._view.scrollLeft=n,this._view.scrollTop=a)},this.panByOffset=function(t,e){t*=this.getZoom(),e*=this.getZoom();var i=this._view.scrollLeft+t,o=this._view.scrollTop+e,s=this._view.scrollWidth-this._view.clientWidth,n=this._view.scrollHeight-this._view.clientHeight;i<0&&(i=0),i>s&&(i=s),o<0&&(o=0),o>n&&(o=n);var a={x:(i-this._view.scrollLeft)/this.getZoom(),y:(o-this._view.scrollTop)/this.getZoom()};return this._view.scrollLeft=i,this._view.scrollTop=o,a},this.getMaxZoom=function(){return this._maxZoom},this.setMaxZoom=function(t){if(!(t<0)){var e=this._maxZoom;this._maxZoom=t,this.firePropertyChange("maxZoom",e,t),this.getZoom()>t&&this.setZoom(t)}},this.getMinZoom=function(){return this._minZoom},this.setMinZoom=function(t){if(!(t<0)){var e=this._minZoom;this._minZoom=t,this.firePropertyChange("minZoom",e,t),this.getZoom()<t&&this.setZoom(t,!1)}},this.getZoom=function(){return this._zoom},this.onZoomChanged=function(t,e){},this.zoomIn=function(t){this.setZoom(this._zoom*Bd.ZOOM_INCREMENT,t)},this.zoomOut=function(t){this.setZoom(this._zoom/Bd.ZOOM_INCREMENT,t)},this.zoomReset=function(t){this.setZoom(1,t)},this.setZoom=function(t,e){if(_third.num(t)&&!(t<=0)&&(t<this._minZoom&&(t=this._minZoom),t>this._maxZoom&&(t=this._maxZoom),t!==this._zoom))if(null==e&&(e=Bd.ZOOM_ANIMATE),e)animate.AnimateManager.start(new animate.AnimateZoom(this,t));else{var i=(this._view.scrollLeft+this._view.clientWidth/2)/this._zoom,o=(this._view.scrollTop+this._view.clientHeight/2)/this._zoom,s=this._zoom;this._zoom=t,html.setZoom(this._rootDiv,t),this.firePropertyChange("zoom",s,t),this.onZoomChanged(s,t),this.centerByLogicalPoint(i,o,!1)}},this.setTouchZoom=function(t){this.setZoom(t,!1)}},invokeExtends("third.controls.View",controls.ViewBase,controls.View),controls.View.prototype.getClassName=function(){return"third.controls.View"},controls.ListBase=function(t){controls.ListBase.superClass.constructor.apply(this,arguments),this._invalidate=!1,this._invalidateModel=!1,this._invalidateDisplay=!1,this._invalidateDatas=null,this._rowDatas=new List,this._startRowIndex=0,this._endRowIndex=0,this._renderMap={},this._dataRowMap={},this.__divPool=new Pool("div",20),this.__imagePool=new Pool("img",20),this.__canvasPool=new Pool("canvas",20),this.__spanPool=new Pool("span",20),this.__textPool=new Pool("span",20),this.__checkBoxPool=new Pool("input",20),this._pools.add(this.__divPool),this._pools.add(this.__imagePool),this._pools.add(this.__canvasPool),this._pools.add(this.__spanPool),this._pools.add(this.__textPool),this._pools.add(this.__checkBoxPool),this._view=html.createView("auto"),this._rootDiv=html.createDiv(),this._dataDiv=html.createDiv(),this._dataDiv.style.width="1px",this._view.appendChild(this._rootDiv),this._rootDiv.appendChild(this._dataDiv),this.setDataBox(t?t:new DataBox);var e=this;e.handleChange&&e._view.addEventListener("change",function(t){e.handleChange(t)},!1);var i;i=UserAgent.isMSToucheable?controls.ListBaseMSTouchInteraction:UserAgent.isTouchable?controls.ListBaseTouchInteraction:controls.ListBaseInteraction,i&&new i(this),this.__bool=["innerText"],this._innerText=Bd.LISTBASE_INNER_TEXT,this.getDataDiv=function(){return this._dataDiv},this.getStartRowIndex=function(){return this._startRowIndex},this.getEndRowIndex=function(){return this._endRowIndex},this.getRowDatas=function(){return this._rowDatas},this.getRowIndexByData=function(t){return this._dataRowMap[t.getId()]},this.getRowIndexById=function(t){return this._dataRowMap[t]},this.getRowSize=function(){return this._rowDatas.size()},this.getDataBox=function(){return this._box},this.setDataBox=function(t){if(!t)throw"DataBox can not be null";if(this._box!==t){var e=this._box;e&&(e.removeDataBoxChangeListener(this.handleDataBoxChange,this),e.removeDataPropertyChangeListener(this.handlePropertyChange,this),e.removeHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel||e.getSelectionModel().removeSelectionChangeListener(this.handleSelectionChange,this)),this._box=t,this._box.addDataBoxChangeListener(this.handleDataBoxChange,this),this._box.addDataPropertyChangeListener(this.handlePropertyChange,this),this._box.addHierarchyChangeListener(this.handleHierarchyChange,this),this._selectionModel?this._selectionModel._setDataBox(t):this._box.getSelectionModel().addSelectionChangeListener(this.handleSelectionChange,this),this.invalidateModel(),this.firePropertyChange("dataBox",e,this._box)}},this.onPropertyChanged=function(t){"zoom"===t.property?this.invalidate():this.invalidateModel()},this.invalidateModel=function(){this._invalidateModel||(this._invalidateModel=!0,this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},this.invalidateDisplay=function(){this._invalidateDisplay||(this._invalidateDisplay=!0,this._invalidateDatas=null,this.invalidate())},this.invalidateData=function(t){this._invalidateDisplay||(this._invalidateDatas||(this._invalidateDatas={}),this._invalidateDatas[t.getId()]=t,this.invalidate())},this.validateImpl=function(){var t=this._view.scrollLeft,e=this._view.scrollTop;this._invalidateModel&&(this._invalidateModel=!1,this.validateModel()),this._invalidateDisplay&&(this._invalidateDisplay=!1,this._renderMap={},html.release(this._dataDiv),this._dataDiv.style.height=this.getRowSize()*this._rowHeight+"px");var i;if(this._invalidateDatas){for(i in this._invalidateDatas){var o=this._renderMap[i];o&&(html.release(o),this._dataDiv.removeChild(o),delete this._renderMap[i])}this._invalidateDatas=null}var s=this._view.scrollTop/this._zoom,n=this._view.clientHeight/this._zoom;this._startRowIndex=Math.floor(s/this._rowHeight)-2,this._endRowIndex=Math.ceil((s+n)/this._rowHeight)+2,this._startRowIndex<0&&(this._startRowIndex=0),this._endRowIndex>this._rowDatas.size()&&(this._endRowIndex=this._rowDatas.size());for(var a=this._rowHeight-this._rowLineWidth-2+"px",h=this._rowLineWidth+"px",r=this._startRowIndex;r<this._endRowIndex;r++){var l=this._rowDatas.get(r);i=l.getId();var d=this._renderMap[i];if(!d){d=this.__divPool.get();var c=d.style;c.position="absolute",c.whiteSpace="nowrap",c.lineHeight=a,c.top=r*this._rowHeight+"px",c.borderStyle="solid",c.borderWidth="0px",c.borderBottomWidth=h,c.borderBottomColor=this._rowLineColor,c.opacity=l.getStyle?l.getStyle("whole.alpha"):1,this._dataDiv.appendChild(d),this._renderMap[i]=d;var _=this.isSelected(l);this.renderData(d,l,r,_),this.onDataRendered(d,l,r,_)}}_third.keys(this._renderMap).forEach(function(t){var e=this.getRowIndexById(t);if(e<this._startRowIndex||e>=this._endRowIndex){var i=this._renderMap[t];html.release(i),this._dataDiv.removeChild(i),delete this._renderMap[t]}},this),this._pools.forEach(function(t){t.clear()}),this._view.scrollLeft!==t&&(this._view.scrollLeft=t),this._view.scrollTop!==e&&(this._view.scrollTop=e),this.adjustRowSize(),this.onValidated()},this.adjustRowSize=function(){var t,e,i=this._rowHeight-this._rowLineWidth+"px",o=Math.floor((this._view.scrollLeft+this._view.clientWidth)/this._zoom)+"px";for(t in this._renderMap)e=this._renderMap[t],e.style.height=i,e.style.width=o},this.onValidated=function(){},this.onDataRendered=function(t,e,i,o){},this._addCheckBox=function(t,e,i){var o=this.__checkBoxPool.get();return o.keepDefault=!0,o.type="checkbox",o.style.margin="0px 2px",o.style.verticalAlign="middle",o._checkData=e,o.checked=i,o.disabled=!1,t.appendChild(o),o},this._addIcon=function(t,e,i,o){var s,n=_third.getImageAsset(i),a=this.getInnerColor(e),h=this.getOuterColor(e),r=this.getAlarmFillColor(e);if(n&&n.getImage()){var l=n.getWidth(),d=n.getHeight();s=this.__canvasPool.get(),s.style.verticalAlign="middle",s.setAttribute("width",l),s.setAttribute("height",d);var c=s.getContext("2d");c.clearRect(0,0,l,d),c.drawImage(n.getImage(a),0,0,l,d),h&&(c.lineWidth=2,c.strokeStyle=h,c.beginPath(),c.rect(0,0,l,d),c.closePath(),c.stroke()),r&&(c.fillStyle=createRadialGradient(c,r,"white",1,d-9,8,8,.75,.25),c.beginPath(),c.arc(5,d-5,4,0,2*Math.PI,!0),c.closePath(),c.fill())}else s=this.__imagePool.get(),s.style.verticalAlign="middle",s.setAttribute("src",_third.getImageSrc(i));s.style.margin="0px 1px 0px 1px",s._selectData=o,t.appendChild(s)},this.isVisible=function(t){return!!this._box.contains(t)&&(!this._visibleFunction||this._visibleFunction(t))},this.handleDataBoxChange=function(t){this.invalidateModel()},this.handlePropertyChange=function(t){"parent"===t.property?this.invalidateModel():this.invalidateData(t.source)},this.handleHierarchyChange=function(t){this.invalidateModel()},this.handleSelectionChange=function(t){t.datas.forEach(function(t){this.invalidateData(t)},this),this.onSelectionChanged(t)},this.getRowIndexAt=function(t){var e=this.getLogicalPoint(t);if(!e)return-1;var i=parseInt(e.y/this._rowHeight);return i>=0&&i<this._rowDatas.size()?i:-1},this.getDataAt=function(t){var e=this.getRowIndexAt(t);return e>=0?this._rowDatas.get(e):null},this.getCurrentSortFunction=function(){return this._sortFunction},this.validateModel=function(){this._rowDatas.clear(),this._dataRowMap={},this._buildChildren(this._box.getRoots()),this._rowDatas=this._rowDatas.toList(this.isVisible,this);var t=this.getCurrentSortFunction();t&&this._rowDatas.sort(t);for(var e=this._rowDatas.size(),i=0;i<e;i++)this._dataRowMap[this._rowDatas.get(i).getId()]=i},this._buildChildren=function(t){t.forEach(function(t){this._rowDatas.add(t),this._buildChildren(t.getChildren())},this)},this._handlePressSelection=function(t,e){var i=this.getSelectionModel();if(_third.isCtrlDown(e))i.contains(t)?i.removeSelection(t):i.appendSelection(t);else if(e.shiftKey&&i.getLastData()){var o=i.getLastData(),s=this.getRowIndexByData(o),n=this.getRowIndexByData(t),a=new List;for(a.add(this.getRowDatas().get(s));s!==n;)s+=n>s?1:-1,a.add(this.getRowDatas().get(s));i.setSelection(a)}else(1!==i.size()||!i.contains(t))&&i.setSelection(t);this.fireInteractionEvent({kind:2===e.detail?"doubleClick":"click",data:t})},this._handleClick=function(t){this.isFocusOnClick()&&thirdUtil.setFocus(this._view);var e=this.getDataAt(t);if(e){if(this.isCheckMode()&&!t.target._checkData){var i=this.getRowIndexByData(e);if(this._focusedRow!==i){var o=this._rowDatas.get(this._focusedRow);this._focusedRow=i,o&&this.invalidateData(o),this.invalidateData(e)}}this.isCheckMode()||this._handlePressSelection(e,t)}this._currentEditor&&this.commitEditValue(this._currentEditor._editInfo,this._currentEditor),this.updateCurrentEditor&&this.updateCurrentEditor(t)},this.handleChange=function(t){if(!this._isCanceling&&!this._isValidating){var e=t.target._checkData;if(e){var i=this.isSelected(e),o=this.getSelectionModel();i?o.removeSelection(e):o.appendSelection(e)}t.target._editInfo&&this.commitEditValue&&this.commitEditValue(t.target._editInfo,t.target)}},this.scrollToData=function(t){var e=this.getRowIndexById(t.getId());if(!(e<0)){var i=e*this._rowHeight*this._zoom,o=i+this._rowHeight*this._zoom,s=this._view.scrollTop;this._view.scrollTop>i&&(s=i),this._view.scrollTop+this._view.clientHeight<o&&(s=o-this._view.clientHeight),this._view.scrollTop!=s&&(this._view.scrollTop=s,this.invalidate())}},this.makeVisible=function(t){this.isVisible(t)&&(this.expand&&this.expand(t),_third.callLater(this.scrollToData,this,[t],2*Bd.CALL_LATER_DELAY))},this.onSelectionChanged=function(t){this._makeVisibleOnSelected&&("append"===t.kind||"set"===t.kind||"all"===t.kind)&&(this.expand&&this.getSelectionModel().getSelection().forEach(function(t){t.getParent()&&this.expand(t.getParent())},this),_third.callLater(this.scrollToData,this,[this.getSelectionModel().getLastData()],2*Bd.CALL_LATER_DELAY))},this.onShareSelectionModelChanged=function(){this.invalidateModel()}},invokeExtends("third.controls.ListBase",controls.View,controls.ListBase),controls.ListBase.prototype.getClassName=function(){return"third.controls.ListBase"},controls.TableBase=function(t){this._columnBox=new ColumnBox,this._columnBox.addDataBoxChangeListener(this.handleColumnBoxChange,this),this._columnBox.addDataPropertyChangeListener(this.handleColumnPropertyChange,this),this._columnBox.addHierarchyChangeListener(this.handleColumnHierarchyChange,this),controls.TableBase.superClass.constructor.apply(this,arguments),this._cellPool=new Pool("div",20),this._stringPool=new Pool("span",20),this._booleanPool=new Pool("input",20),this._colorPool=new Pool("div",20),this._pools.add(this._cellPool),this._pools.add(this._stringPool),this._pools.add(this._booleanPool),this._pools.add(this._colorPool),this.getColumnBox=function(){return this._columnBox},this.handleColumnBoxChange=function(t){this.invalidateDisplay()},this.handleColumnPropertyChange=function(t){t.source!==this._sortColumn||"sortDirection"!==t.property&&"sortFunction"!==t.property&&"sortable"!==t.property?this.invalidateDisplay():this.invalidateModel()},this.handleColumnHierarchyChange=function(t){this.invalidateDisplay()},this.renderData=function(t,e,i,o){for(var s,n=this._columnBox.getRoots(),a=n.size(),h=0,r=this._rowHeight-this._rowLineWidth+"px",l=0;l<a;l++){var d=n.get(l),c=d.getWidth();c<0&&(c=0);var _=Math.min(this._columnLineWidth,c);if(d.isVisible()){var u=this._cellPool.get();s=u.style,s.position="absolute",s.whiteSpace="nowrap",s.verticalAlign="middle",s.textAlign=d.getHorizontalAlign(),s.overflow="hidden",s.textOverflow="ellipsis",s.left=h+"px",s.width=c-_+"px",s.height=r,s.borderStyle="solid",s.borderWidth="0px",s.borderRightWidth=_+"px",s.borderRightColor=this._columnLineColor,0===l?(s.borderLeftWidth=_+"px",s.borderLeftColor=this._columnLineColor):s.borderLeftWidth="0px",t.appendChild(u);var v={data:e,value:this.getValue(e,d),div:u,view:this,column:d,rowIndex:i,selected:o};this.renderCell(v),this.onCellRendered(v),h+=c}}s=t.style,s.width=h+"px",s.height=r,s.backgroundColor=this.isCheckMode()&&this._focusedRow===i||!this.isCheckMode()&&o?this.getSelectColor(e):""},this.adjustRowSize=function(){},this.onCellRendered=function(t){},this.getCurrentSortFunction=function(){var t=this._sortColumn;if(t){var e=t.getSortFunction();if(e){var i=this,o="asc"===t.getSortDirection()?1:-1;return function(s,n){var a=i.getValue(s,t),h=i.getValue(n,t);return e.call(i,a,h,s,n)*o}}}return this._sortFunction},this.renderCell=function(t){var e=t.column;if(e.renderCell)return void e.renderCell(t);var i=t.value,o=e.getEnumInfo();o&&!Array.isArray(o)&&(i=o.map[i]),t.view.isCellEditable(t.data,e)&&(t.enumInfo=o,t.div._editInfo=t),_render.render(e.getValueType(),i,t.div,t.view,e.isInnerText())},this.getValue=function(t,e){return e.getValue(t,this)},this.setValue=function(t,e,i){e.setValue(t,i,this)},this.getColumnAt=function(t){var e=this.getLogicalPoint(t);if(!e)return null;for(var i=this._columnBox.getRoots(),o=0,s=i.size(),n=0;o<s;o++){var a=i.get(o),h=a.getWidth();if(h<0&&(h=0),e.x>n&&e.x<n+h)return a;n+=h}return null},this.isCellEditable=function(t,e){return this.isEditable()&&e.isEditable()},this.commitEditValue=function(t,e){if(!this._isCanceling){var i;i="checkbox"===e.type?e.checked:e.value;var o=t.column,s=o.getValueType();if("int"===s&&"string"==typeof i?i=parseInt(i):"number"===s&&"string"==typeof i&&(i=parseFloat(i)),this.setValue(t.data,o,i),this._currentEditor){var n=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(n),thirdUtil.setFocus(this._view)}delete this._isCommitting}},this.cancelEditing=function(){if(this._currentEditor){this._isCanceling=!0;var t=this._currentEditor;delete this._currentEditor,this._rootDiv.removeChild(t),thirdUtil.setFocus(this._view),delete this._isCanceling}},this.updateCurrentEditor=function(t){var e=t.target;if(e!==this._currentEditor&&e.parentNode!==this._currentEditor){for(var i;e&&e!==this._view&&!i;)i=e._editInfo,e=e.parentNode;if(i&&e===i.div&&(i.enumInfo?this._currentEditor=html.createSelect(i.enumInfo,i.value):(this._currentEditor=document.createElement("input"),null!=i.value&&(this._currentEditor.value=i.value)),this._currentEditor)){this._currentEditor.addEventListener("keydown",function(t){var e=t.target._editInfo.view;13===t.keyCode?e.commitEditValue(t.target._editInfo,t.target):27===t.keyCode&&e.cancelEditing()},!1),this._currentEditor.addEventListener("blur",function(t){var e=t.target._editInfo.view;e._isCanceling||e.commitEditValue(t.target._editInfo,t.target)},!1),this._currentEditor.keepDefault=!0,this._currentEditor._editInfo=i;var o=this._currentEditor.style;o.position="absolute",o.margin="0px",o.border="0px",o.padding="0px",o.left=i.div.style.left,o.top=i.div.parentNode.style.top,o.width=i.div.style.width,o.height=i.div.style.height,this._rootDiv.appendChild(this._currentEditor),thirdUtil.setFocus(this._currentEditor)}}},this.onColumnSorted=function(t){},this.getCurrentEditor=function(){return this._currentEditor}},invokeExtends("third.controls.TableBase",controls.ListBase,controls.TableBase),controls.TableBase.prototype.getClassName=function(){return"third.controls.TableBase"},controls.List=function(t){controls.List.superClass.constructor.apply(this,arguments),this.__accessor=["rowHeight","indent","rowLineWidth","rowLineColor","sortFunction","visibleFunction"],this.__bool=["makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],this._checkMode=!1,this._rowHeight=Bd.LIST_ROW_HEIGHT,this._indent=Bd.LIST_INDENT,this._rowLineWidth=Bd.LIST_ROW_LINE_WIDTH,this._rowLineColor=Bd.LIST_ROW_LINE_COLOR,this._makeVisibleOnSelected=Bd.LIST_MAKE_VISIBLE_ON_SELECTED,this._keyboardRemoveEnabled=Bd.LIST_KEYBOARD_REMOVE_ENABLED,this._keyboardSelectEnabled=Bd.LIST_KEYBOARD_SELECT_ENABLED,this.isCheckMode=function(){return this._checkMode},this.setCheckMode=function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},this.isCheckable=function(t){return this._checkMode===!0},this.renderData=function(t,e,i,o){var s;this._indent>0&&(s=this.__spanPool.get(),s.style.width=this._indent+"px",s.style.display="inline-block",t.appendChild(s));var n=this.isCheckable(e);n&&this._addCheckBox(t,e,o);var a=this.getIcon(e);a&&this._addIcon(t,e,a);var h=this.getLabel(e);if(h){s=this.__textPool.get();var r=s.style;r.whiteSpace="nowrap",r.verticalAlign="middle",r.padding="1px 2px 1px 2px",r.display="inline-block",_third.setText(s,h,this._innerText),this.onLabelRendered(s,e,h,i,o),t.appendChild(s)}this.isCheckMode()?t.style.backgroundColor=this._focusedRow===i?this.getSelectColor(e):"":t.style.backgroundColor=o?this.getSelectColor(e):""},this.onLabelRendered=function(t,e,i,o,s){}},invokeExtends("third.controls.List",controls.ListBase,controls.List),controls.List.prototype.getClassName=function(){return"third.controls.List"},controls.Tree=function(t){this._interactionDispatcher=new EventDispatcher,this._initTree(t),controls.Tree.superClass.constructor.apply(this,arguments),this.__tree=1,this.__accessor=["rootData","sortFunction","visibleFunction","indent","rowHeight","rowLineWidth","rowLineColor","expandIcon","collapseIcon","uncheckableStyle"],this.__bool=["rootVisible","makeVisibleOnSelected","keyboardRemoveEnabled","keyboardSelectEnabled"],this._checkMode=!1,this._indent=Bd.TREE_INDENT,this._rowHeight=Bd.TREE_ROW_HEIGHT,this._rowLineWidth=Bd.TREE_ROW_LINE_WIDTH,this._rowLineColor=Bd.TREE_ROW_LINE_COLOR,this._makeVisibleOnSelected=Bd.TREE_MAKE_VISIBLE_ON_SELECTED,this._keyboardRemoveEnabled=Bd.TREE_KEYBOARD_REMOVE_ENABLED,this._keyboardSelectEnabled=Bd.TREE_KEYBOARD_SELECT_ENABLED,this._expandIcon=Bd.TREE_EXPAND_ICON,this._collapseIcon=Bd.TREE_COLLAPSE_ICON,this._uncheckableStyle="none",this.getCheckMode=function(){return this._checkMode},this.setCheckMode=function(t){delete this._focusedRow;var e=this._checkMode;this._checkMode=t,this.firePropertyChange("checkMode",e,t)},this.renderData=function(t,e,i,o){this._renderTree(t,e,i,o)}},invokeExtends("third.controls.Tree",controls.ListBase,controls.Tree),controls.Tree.prototype.getClassName=function(){return"third.controls.Tree"},module.exports=controls;