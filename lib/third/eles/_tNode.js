var _third=require("./../core/_third"),_con=require("./../constants/index"),Bd=_con.Bd,Telement=require("./_tElement"),List=require("./../core/_list"),math=require("./../core/_math"),invokeExtends=require("./../core/_ext"),Tnode=function t(i){this._location={x:0,y:0},t.superClass.constructor.call(this,i),this._icon=Bd.ICON_NODE,this._image=Bd.IMAGE_NODE,this._angle=0,this.getLoopedLinks=function(){return this._loopedLinks},this.getLinks=function(){return this._links},this.getAgentLinks=function(){return this._agentLinks},this.getFollowers=function(){return this._followers},this._addFollower=function(t){this._followers||(this._followers=new List),this._followers.add(t)},this._removeFollower=function(t){this._followers.remove(t),this._followers.isEmpty()&&delete this._followers},this.getFromLinks=function(){return this._fromLinks},this.getToLinks=function(){return this._toLinks},this._addFromLink=function(t){this._allLinks||(this._allLinks=new List),this._fromLinks||(this._fromLinks=new List),this._allLinks.add(t),this._fromLinks.add(t),this._resetLinkSet()},this._addToLink=function(t){this._allLinks||(this._allLinks=new List),this._toLinks||(this._toLinks=new List),this._allLinks.add(t),this._toLinks.add(t),this._resetLinkSet()},this._removeFromLink=function(t){this._allLinks.remove(t),this._fromLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._fromLinks.size()&&delete this._fromLinks,this._resetLinkSet()},this._removeToLink=function(t){this._allLinks.remove(t),this._toLinks.remove(t),0===this._allLinks.size()&&delete this._allLinks,0===this._toLinks.size()&&delete this._toLinks,this._resetLinkSet()},this._resetLinkSet=function(){if(delete this._loopedLinks,!this._allLinks||0===this._allLinks.size())return void delete this._links;var t;this._allLinks.forEach(function(i){i.isLooped()&&(t||(t={}),t[i._id]||(this._loopedLinks||(this._loopedLinks=new List),this._loopedLinks.add(i),t[i._id]=i))},this),t?(this._links=new List,this._allLinks.forEach(function(i){t[i._id]?t[i._id]!==!1&&(t[i._id]=!1,this._links.add(i)):this._links.add(i)},this)):this._links=this._allLinks},this.hasAgentLinks=function(){return null!=this._agentLinks&&!this._agentLinks.isEmpty()},this.getFromAgentLinks=function(){return this._fromAgentLinks},this.getToAgentLinks=function(){return this._toAgentLinks},this._addFromAgentLink=function(t){this._fromAgentLinks||(this._fromAgentLinks=new List),this._allAgentLinks||(this._allAgentLinks=new List),this._fromAgentLinks.add(t),this._allAgentLinks.add(t),this._resetAgentLinkSet()},this._addToAgentLink=function(t){this._toAgentLinks||(this._toAgentLinks=new List),this._allAgentLinks||(this._allAgentLinks=new List),this._toAgentLinks.add(t),this._allAgentLinks.add(t),this._resetAgentLinkSet()},this._removeFromAgentLink=function(t){this._fromAgentLinks.remove(t),this._allAgentLinks.remove(t),0===this._fromAgentLinks.size()&&delete this._fromAgentLinks,0===this._allAgentLinks.size()&&delete this._allAgentLinks,this._resetAgentLinkSet()},this._removeToAgentLink=function(t){this._toAgentLinks.remove(t),this._allAgentLinks.remove(t),0===this._toAgentLinks.size()&&delete this._toAgentLinks,0===this._allAgentLinks.size()&&delete this._allAgentLinks,this._resetAgentLinkSet()},this._resetAgentLinkSet=function(){if(delete this._agentLinks,this._allAgentLinks&&0!==this._allAgentLinks.size()){var t={};this._allAgentLinks.forEach(function(i){t[i._id]?this._agentLinks||(this._agentLinks=new List):t[i._id]=i},this),this._agentLinks?this._allAgentLinks.forEach(function(i){t[i._id]&&(this._agentLinks.add(i),delete t[i._id])},this):this._agentLinks=this._allAgentLinks}},this.getImage=function(){return this._image},this.setImage=function(t){var i=this._image,e=this.getWidth(),s=this.getHeight();this._image=t,this.firePropertyChange("image",i,t),this.firePropertyChange("width",e,this.getWidth()),this.firePropertyChange("height",s,this.getHeight())},this.getX=function(){return this._location.x},this.getY=function(){return this._location.y},this.setX=function(t){this.setLocation(t,this._location.y)},this.setY=function(t){this.setLocation(this._location.x,t)},this.getLocation=function(){return this._location},this.setLocation=function(t,i){var e;if(e=2===arguments.length?{x:arguments[0],y:arguments[1]}:arguments[0],_third.num(e.x)&&_third.num(e.y)&&(e.x!==this._location.x||e.y!==this._location.y)){var s=this._location;this._location=e,this.firePropertyChange("location",s,e)}},this.getCenterLocation=function(){return{x:this.getX()+this.getWidth()/2,y:this.getY()+this.getHeight()/2}},this.setCenterLocation=function(t,i){var e;e=2===arguments.length?{x:arguments[0],y:arguments[1]}:_third.clone(arguments[0]),_third.num(e.x)&&_third.num(e.y)&&(e.x-=this.getWidth()/2,e.y-=this.getHeight()/2,this.setLocation(e))},this.translate=function(t,i){this.setLocation(this.getX()+t,this.getY()+i)},this.getWidth=function(){if(_third.num(this._width)&&this._width>=0)return this._width;var t=_third.getImageAsset(this._image);if(t){var i=t.getWidth();if(_third.num(i)&&i>=0)return i}return Bd.NODE_WIDTH},this.setWidth=function(t){var i=this._width;this._width=t,this.firePropertyChange("width",i,t)},this.getHeight=function(){if(_third.num(this._height)&&this._height>=0)return this._height;var t=_third.getImageAsset(this._image);if(t){var i=t.getHeight();if(_third.num(i)&&i>=0)return i}return Bd.NODE_HEIGHT},this.setHeight=function(t){var i=this._height;this._height=t,this.firePropertyChange("height",i,t)},this.setSize=function(){2===arguments.length?(this.setWidth(arguments[0]),this.setHeight(arguments[1])):(this.setWidth(arguments[0].width),this.setHeight(arguments[0].height))},this.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}},this.getRect=function(){if(0===this._angle)return this.getOriginalRect();for(var t=math.createMatrix(this._angle*Math.PI/180,this.getX()+this.getWidth()/2,this.getY()+this.getHeight()/2),i=[{x:this.getX(),y:this.getY()},{x:this.getX()+this.getWidth(),y:this.getY()},{x:this.getX()+this.getWidth(),y:this.getY()+this.getHeight()},{x:this.getX(),y:this.getY()+this.getHeight()}],e=0,s=i.length;e<s;e++)i[e]=t.transform(i[e]);var n=math.getRect(i);return n},this.getOriginalRect=function(){return{x:this.getX(),y:this.getY(),width:this.getWidth(),height:this.getHeight()}},this.getAngle=function(){return this._angle},this.setAngle=function(t){var i=this._angle;this._angle=t%360,this.firePropertyChange("angle",i,this._angle)},this.onParentChanged=function(i,e){t.superClass.onParentChanged.call(this,i,e),this._checkLinkAgent()}};Tnode.IS_INTERESTED_NODE_PROPERTY={location:1,width:1,height:1,expanded:1},invokeExtends("third.Tnode",Telement,Tnode),Tnode.prototype.getClassName=function(){return"third.Tnode"},module.exports=Tnode;