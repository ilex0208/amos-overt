{"version":3,"sources":["../src/_link.js"],"names":["_e","require","Util","Tobj","InteractiveElement","getLinksArray","node_a","node_b","resultArray","a_outlinks","outLinks","b_inlinks","inLinks","i","length","link1","j","link2","push","getAllLinks","a_bLinks","b_aLinks","allLinks","concat","getOtherLinksByLink","link","nodeA","nodeZ","filter","item","getLinksSize","Link","text","getInterSection","dline","lineF","cx","cy","zbound","getBound","_intersection","intersectionLineBound","initialize","_nodeA","_nodeZ","linkText","prototype","apply","arguments","elementType","zIndex","zIndex_Link","caculateIndex","font","fontColor","lineWidth","lineJoin","transformAble","bundleOffset","bundleGap","textOffsetX","textOffsetY","arrowsRadius","arrowsOffset","dashedPattern","path","linkProperties","split","serializedProperties","size","nodeIndex","removeHandler","_self","ols","ils","otherLinks","forEach","value","index","getStartPosition","pos","x","y","getEndPosition","endPos","getPath","$path","startPos","radian","Math","atan2","g","cos","sin","h","PI","k","l","m","n","paintPath","ctx","paths","paintLoop","beginPath","moveTo","lineTo","AmostDashedLineTo","stroke","closePath","path_last_2","path_last","paintArrow","radius","arc","path_2","lastPath","arrowOff","ar_2","$path_2","$lastPath","distance","getDistance","arrow_k","arrow_l","arrowX","arrowY","movePos","arrowLineto","fillStyle","strokeColor","alpha","paint","strokeStyle","paintText","_PI","_path","path_0","_width","_heigth","save","textW","measureText","width","defaultW","gap","azX","azY","fillText","restore","paintSelected","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","isInBound","_x","_y","abs","falg","prevPath","nextPath","isPointInLine","FoldLink","direction","height","sp","ep","$x","$y","span","_paths","FlexionalLink","offsetGap","$startPos","$endPos","offGap","CurveLink","prevLink","nextLink","distanceX","distanceY","quadraticCurveTo","module","exports"],"mappings":"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","file":"_link.js","sourcesContent":["//////////////////////////////\n/**\n * @author ilex\n * @description Link 2016-11-15 10:20:12\n */\n//////////////////////////////\nconst _e = require('./_baseElement');\nconst Util = require('./_util');\nconst Tobj = require('./_tobj');\n\nconst InteractiveElement = _e.InteractiveElement;\n/**\n * 获取两个节点之间的links集合\n * exp: getLinksArray(node_a, node_b) 表示： 获取\n * @param {any} node_a\n * @param {any} node_b\n * @returns array\n */\nfunction getLinksArray(node_a, node_b) {\n  let resultArray = [];\n  if (null == node_a || null == node_b) {\n    return resultArray;\n  }\n  if (node_a && node_b) {\n    let a_outlinks = node_a.outLinks;\n    let b_inlinks = node_b.inLinks;\n    // 循环遍历 node_a 中 outLinks 存储的每一项link\n    if(a_outlinks && b_inlinks){\n      for (let i = 0; i < a_outlinks.length; i++) {\n        let link1 = a_outlinks[i];\n        for (let j = 0; j < b_inlinks.length; j++) {\n          let link2 = b_inlinks[j];\n          if(link1 === link2){\n            resultArray.push(link2);\n          }\n        }\n      }\n    }\n  }\n  return resultArray;\n}\n\n/**\n * 获取两个节点的所有链路\n * (表示: node_a到node_b的链路以及node_b到node_a的链路)\n * @param {any} node_a\n * @param {any} node_b\n * @returns array\n */\nfunction getAllLinks(node_a, node_b) {\n  let a_bLinks = getLinksArray(node_a, node_b),\n    b_aLinks = getLinksArray(node_b, node_a),\n    allLinks = a_bLinks.concat(b_aLinks);\n  return allLinks;\n}\n\n/**\n * 通过链路获取当前链路两节点之间的其它链路\n * @param {any} link\n * @returns\n */\nfunction getOtherLinksByLink(link) {\n  let allLinks = getAllLinks(link.nodeA, link.nodeZ);\n  return allLinks = allLinks.filter(function(item) {\n    return link !== item;\n  });\n}\n\n/**\n * 获取两节点之间链路总数\n *\n * @param {any} node_a\n * @param {any} node_b\n * @returns\n */\nfunction getLinksSize(node_a, node_b) {\n  return getAllLinks(node_a, node_b).length;\n}\n\n/**\n * 创建链路\n *\n * @param {any} nodeA 节点A\n * @param {any} nodeZ 节点B\n * @param {any} text link名称\n */\nfunction Link(nodeA, nodeZ, text) {\n  /**\n   * 获取相交点\n   * @param {any} nodeZ\n   * @param {any} nodeA\n   * @returns {x:number,y:number}\n   */\n  function getInterSection(nodeZ, nodeA) {\n    let dline = Util.lineF(nodeZ.cx, nodeZ.cy, nodeA.cx, nodeA.cy),\n      zbound = nodeZ.getBound(),\n      _intersection = Util.intersectionLineBound(dline, zbound);// 获取相交点\n    return _intersection;\n  }\n\n  this.initialize = function(_nodeA, _nodeZ, linkText) {\n    Link.prototype.initialize.apply(this, arguments),\n      this.elementType = 'link',\n      this.zIndex = Tobj.zIndex_Link;\n    if (0 != arguments.length) {\n      this.text = linkText,\n        this.nodeA = _nodeA,\n        this.nodeZ = _nodeZ,\n        this.nodeA && null == this.nodeA.outLinks && (this.nodeA.outLinks = []),\n        this.nodeA && null == this.nodeA.inLinks && (this.nodeA.inLinks = []),\n        this.nodeZ && null == this.nodeZ.inLinks && (this.nodeZ.inLinks = []),\n        this.nodeZ && null == this.nodeZ.outLinks && (this.nodeZ.outLinks = []),\n        null != this.nodeA && this.nodeA.outLinks.push(this),\n        null != this.nodeZ && this.nodeZ.inLinks.push(this),\n        this.caculateIndex(),\n        this.font = '12px Consolas',\n        this.fontColor = '255,255,255',\n        this.lineWidth = 2,\n        this.lineJoin = 'miter',\n        this.transformAble = !1,\n        this.bundleOffset = 20,\n        this.bundleGap = 12,\n        this.textOffsetX = 0,\n        this.textOffsetY = 0,\n        this.arrowsRadius = null,\n        this.arrowsOffset = 0,\n        this.dashedPattern = null,\n        this.path = [];\n      let linkProperties = 'text,font,fontColor,lineWidth,lineJoin'.split(',');\n      this.serializedProperties = this.serializedProperties.concat(linkProperties);\n    }\n  },\n  this.caculateIndex = function() {\n    let size = getLinksSize(this.nodeA, this.nodeZ);\n    // 以下代码等价写法:  size > 0 && (this.nodeIndex = size - 1);\n    if(size > 0){\n      this.nodeIndex = size - 1;\n    }\n  },\n  this.initialize(nodeA, nodeZ, text),\n  /**\n   * 移除\n   */\n  this.removeHandler = function() {\n    let _self = this;\n    this.nodeA && this.nodeA.outLinks && (this.nodeA.outLinks = this.nodeA.outLinks.filter(function(ols) {\n      return ols !== _self;\n    })),\n    this.nodeZ && this.nodeZ.inLinks && (this.nodeZ.inLinks = this.nodeZ.inLinks.filter(function(ils) {\n      return ils !== _self;\n    }));\n    let otherLinks = getOtherLinksByLink(this);\n    otherLinks.forEach(function(value, index) {\n      value.nodeIndex = index;\n    });\n  },\n  this.getStartPosition = function() {\n    let pos = {\n      x: this.nodeA.cx,\n      y: this.nodeA.cy\n    };\n    return pos;\n  },\n  this.getEndPosition = function() {\n    let endPos;\n    return null != this.arrowsRadius && (endPos = getInterSection(this.nodeZ, this.nodeA)),\n      null == endPos && (endPos = {\n        x: this.nodeZ.cx,\n        y: this.nodeZ.cy\n      }),\n      endPos;\n  },\n  this.getPath = function() {\n    let $path = [],\n      startPos = this.getStartPosition(),\n      endPos = this.getEndPosition();\n    if (this.nodeA === this.nodeZ) {\n      return [startPos, endPos];\n    }\n    let size = getLinksSize(this.nodeA, this.nodeZ);\n    if (1 == size) {\n      return [startPos, endPos];\n    }\n    // atan2(x,y)表示: 坐标与X轴之间的角度的弧度\n    let radian = Math.atan2(endPos.y - startPos.y, endPos.x - startPos.x),\n      g = {\n        x: startPos.x + this.bundleOffset * Math.cos(radian),\n        y: startPos.y + this.bundleOffset * Math.sin(radian)\n      },\n      h = {\n        x: endPos.x + this.bundleOffset * Math.cos(radian - Math.PI),\n        y: endPos.y + this.bundleOffset * Math.sin(radian - Math.PI)\n      },\n      i = radian - Math.PI / 2,\n      j = radian - Math.PI / 2,\n      k = size * this.bundleGap / 2 - this.bundleGap / 2,\n      l = this.bundleGap * this.nodeIndex,\n      m = {\n        x: g.x + l * Math.cos(i),\n        y: g.y + l * Math.sin(i)\n      },\n      n = {\n        x: h.x + l * Math.cos(j),\n        y: h.y + l * Math.sin(j)\n      };\n    return m = {\n      x: m.x + k * Math.cos(i - Math.PI),\n      y: m.y + k * Math.sin(i - Math.PI)\n    },\n      n = {\n        x: n.x + k * Math.cos(j - Math.PI),\n        y: n.y + k * Math.sin(j - Math.PI)\n      },\n      $path.push({\n        x: startPos.x,\n        y: startPos.y\n      }),\n      $path.push({\n        x: m.x,\n        y: m.y\n      }),\n      $path.push({\n        x: n.x,\n        y: n.y\n      }),\n      $path.push({\n        x: endPos.x,\n        y: endPos.y\n      }),\n      $path;\n  },\n  /**\n   * 绘制路线\n   * @param {any} ctx context\n   * @param {array} paths 路线集合\n   */\n  this.paintPath = function(ctx, paths) {\n    // 执行paintLoop,同时返回undefined\n    if (this.nodeA === this.nodeZ) {\n      return void this.paintLoop(ctx);\n    }\n    ctx.beginPath();\n    ctx.moveTo(paths[0].x, paths[0].y);\n    for (let i = 1; i < paths.length; i++) {\n      null == this.dashedPattern ? ctx.lineTo(paths[i].x, paths[i].y) : ctx.AmostDashedLineTo(paths[i - 1].x, paths[i - 1].y, paths[i].x, paths[i].y, this.dashedPattern);\n    }\n    ctx.stroke();\n    ctx.closePath();\n    if (null != this.arrowsRadius) {\n      let path_last_2 = paths[paths.length - 2],\n        path_last = paths[paths.length - 1];\n      this.paintArrow(ctx, path_last_2, path_last);\n    }\n  },\n  this.paintLoop = function(ctx) {\n    // 计算半径\n    let radius = this.bundleGap * (this.nodeIndex + 1) / 2;\n    ctx.beginPath();\n    ctx.arc(this.nodeA.x, this.nodeA.y, radius, Math.PI / 2, 2 * Math.PI);\n    ctx.stroke();\n    ctx.closePath();\n  },\n\n  /**\n   * 绘制箭头\n   * @param {any} ctx context\n   * @param {any} path_2 倒数第2个link\n   * @param {any} lastPath 最后一个link\n   */\n  this.paintArrow = function(ctx, path_2, lastPath) {\n    let arrowOff = this.arrowsOffset,\n      ar_2 = this.arrowsRadius / 2,\n      $path_2 = path_2,\n      $lastPath = lastPath,\n      // 计算出两条线之间的弧度\n      radian = Math.atan2($lastPath.y - $path_2.y, $lastPath.x - $path_2.x),\n      distance = Util.getDistance($path_2, $lastPath) - this.arrowsRadius,\n      arrow_k = $path_2.x + (distance + arrowOff) * Math.cos(radian),\n      arrow_l = $path_2.y + (distance + arrowOff) * Math.sin(radian),\n      arrowX = $lastPath.x + arrowOff * Math.cos(radian),\n      arrowY = $lastPath.y + arrowOff * Math.sin(radian);\n    radian -= Math.PI / 2;\n    // 开始画箭头时,先移动到位置\n    let movePos = {\n        x: arrow_k + ar_2 * Math.cos(radian),\n        y: arrow_l + ar_2 * Math.sin(radian)\n      },\n      arrowLineto = {\n        x: arrow_k + ar_2 * Math.cos(radian - Math.PI),\n        y: arrow_l + ar_2 * Math.sin(radian - Math.PI)\n      };//\n    ctx.beginPath(),\n      ctx.fillStyle = 'rgba(' + this.strokeColor + ',' + this.alpha + ')',\n      ctx.moveTo(movePos.x, movePos.y),\n      ctx.lineTo(arrowX, arrowY),\n      ctx.lineTo(arrowLineto.x, arrowLineto.y),\n      ctx.stroke(),\n      ctx.closePath();\n  },\n  this.paint = function(ctx) {\n    if (null != this.nodeA && null != !this.nodeZ) {\n      let paths = this.getPath(this.nodeIndex);\n      this.path = paths,\n        ctx.strokeStyle = 'rgba(' + this.strokeColor + ',' + this.alpha + ')',\n        ctx.lineWidth = this.lineWidth,\n        this.paintPath(ctx, paths),\n        paths && paths.length > 0 && this.paintText(ctx, paths);\n    }\n  };\n  let _PI = -(Math.PI / 2 + Math.PI / 4);\n  this.paintText = function(ctx, _path) {\n    let path_0 = _path[0],\n      path_last = _path[_path.length - 1];\n    if(_path.length == 4){\n      path_0 = _path[1], path_last = _path[2];\n    }\n    if (this.text && this.text.length > 0) {\n      let _width = (path_last.x + path_0.x) / 2 + this.textOffsetX,\n        _heigth = (path_last.y + path_0.y) / 2 + this.textOffsetY;\n      ctx.save(),\n        ctx.beginPath(),\n        ctx.font = this.font;\n      let textW = ctx.measureText(this.text).width,\n        defaultW = ctx.measureText('田').width;\n      ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')';\n      if (this.nodeA === this.nodeZ) {\n        let gap = this.bundleGap * (this.nodeIndex + 1) / 2,\n          azX = this.nodeA.x + gap * Math.cos(_PI),\n          azY = this.nodeA.y + gap * Math.sin(_PI);\n        ctx.fillText(this.text, azX, azY);\n      } else {\n        ctx.fillText(this.text, _width - textW / 2, _heigth - defaultW / 2);\n      }\n      ctx.stroke(),\n        ctx.closePath(),\n        ctx.restore();\n    }\n  },\n  this.paintSelected = function(ctx) {\n    ctx.shadowBlur = 10,\n      ctx.shadowColor = 'rgba(0,0,0,1)',\n      ctx.shadowOffsetX = 0,\n      ctx.shadowOffsetY = 0;\n  },\n  this.isInBound = function(_x, _y) {\n    if (this.nodeA === this.nodeZ) {\n      let gap = this.bundleGap * (this.nodeIndex + 1) / 2,\n        distance = Util.getDistance( this.nodeA, {x: _x, y: _y} ) - gap;\n      return Math.abs(distance) <= 3;\n    }\n    let falg = false;\n    for (let i = 1; i < this.path.length; i++) {\n      let prevPath = this.path[i - 1], nextPath = this.path[i];\n      if (1 == Util.isPointInLine( {x: _x,y: _y}, prevPath, nextPath)) {\n        falg = true;\n        break;\n      }\n    }\n    return falg;\n  };\n}\n\n/**\n * 创建折叠Link\n *\n * @param {any} nodeA 节点A\n * @param {any} nodeZ 节点B\n * @param {any} text link名称\n */\nfunction FoldLink(nodeA, nodeZ, text) {\n  this.initialize = function() {\n    FoldLink.prototype.initialize.apply(this, arguments),\n      this.direction = 'horizontal';\n  },\n  this.initialize(nodeA, nodeZ, text),\n  this.getStartPosition = function() {\n    let startPos = {\n      x: this.nodeA.cx,\n      y: this.nodeA.cy\n    };\n    return 'horizontal' == this.direction ? this.nodeZ.cx > startPos.x ? startPos.x += this.nodeA.width / 2 : startPos.x -= this.nodeA.width / 2 : this.nodeZ.cy > startPos.y ? startPos.y += this.nodeA.height / 2 : startPos.y -= this.nodeA.height / 2,\n      startPos;\n  },\n  this.getEndPosition = function() {\n    let startPos = {\n      x: this.nodeZ.cx,\n      y: this.nodeZ.cy\n    };\n    return 'horizontal' == this.direction ? this.nodeA.cy < startPos.y ? startPos.y -= this.nodeZ.height / 2 : startPos.y += this.nodeZ.height / 2 : startPos.x = this.nodeA.cx < startPos.x ? this.nodeZ.x : this.nodeZ.x + this.nodeZ.width,\n      startPos;\n  },\n  this.getPath = function(nodeIndex) {\n    let paths = [],\n      sp = this.getStartPosition(),\n      ep = this.getEndPosition();\n    if (this.nodeA === this.nodeZ) {\n      return [sp, ep];\n    }\n    let $x, $y, size = getLinksSize(this.nodeA, this.nodeZ),\n      span = (size - 1) * this.bundleGap,\n      gap = this.bundleGap * nodeIndex - span / 2;\n    return 'horizontal' == this.direction ? ($x = ep.x + gap, $y = sp.y - gap, paths.push({\n      x: sp.x,\n      y: $y\n    }), paths.push({\n      x: $x,\n      y: $y\n    }), paths.push({\n      x: $x,\n      y: ep.y\n    })) : ($x = sp.x + gap, $y = ep.y - gap, paths.push({\n      x: $x,\n      y: sp.y\n    }), paths.push({\n      x: $x,\n      y: $y\n    }), paths.push({\n      x: ep.x,\n      y: $y\n    })),\n      paths;\n  },\n  this.paintText = function(ctx, _paths) {\n    if (this.text && this.text.length > 0) {\n      let $path = _paths[1],\n        _x = $path.x + this.textOffsetX,\n        _y = $path.y + this.textOffsetY;\n      ctx.save(),\n        ctx.beginPath(),\n        ctx.font = this.font;\n      let textW = ctx.measureText(this.text).width,\n        defaultW = ctx.measureText('田').width;\n      ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')',\n        ctx.fillText(this.text, _x - textW / 2, _y - defaultW / 2),\n        ctx.stroke(),\n        ctx.closePath(),\n        ctx.restore();\n    }\n  };\n}\n\n/**\n * 创建可弯曲的Link\n *\n * @param {any} nodeA 节点A\n * @param {any} nodeZ 节点B\n * @param {any} text link名称\n */\nfunction FlexionalLink(nodeA, nodeZ, text) {\n  this.initialize = function() {\n    FlexionalLink.prototype.initialize.apply(this, arguments),\n      this.direction = 'vertical',\n      this.offsetGap = 44;\n  },\n  this.initialize(nodeA, nodeZ, text),\n  this.getStartPosition = function() {\n    let sp = {\n      x: this.nodeA.cx,\n      y: this.nodeA.cy\n    };\n    return 'horizontal' == this.direction ? sp.x = this.nodeZ.cx < sp.x ? this.nodeA.x : this.nodeA.x + this.nodeA.width : sp.y = this.nodeZ.cy < sp.y ? this.nodeA.y : this.nodeA.y + this.nodeA.height,\n      sp;\n  },\n  this.getEndPosition = function() {\n    let ep = {\n      x: this.nodeZ.cx,\n      y: this.nodeZ.cy\n    };\n    return 'horizontal' == this.direction ? ep.x = this.nodeA.cx < ep.x ? this.nodeZ.x : this.nodeZ.x + this.nodeZ.width : ep.y = this.nodeA.cy < ep.y ? this.nodeZ.y : this.nodeZ.y + this.nodeZ.height,\n      ep;\n  },\n  this.getPath = function(nodeIndex) {\n    let $startPos = this.getStartPosition(),\n      $endPos = this.getEndPosition();\n    if (this.nodeA === this.nodeZ) {\n      return [$startPos, $endPos];\n    }\n    let paths = [],\n      size = getLinksSize(this.nodeA, this.nodeZ),\n      span = (size - 1) * this.bundleGap,\n      gap = this.bundleGap * nodeIndex - span / 2,\n      offGap = this.offsetGap;\n    return 'horizontal' == this.direction ? (this.nodeA.cx > this.nodeZ.cx && (offGap = -offGap), paths.push({\n      x: $startPos.x,\n      y: $startPos.y + gap\n    }), paths.push({\n      x: $startPos.x + offGap,\n      y: $startPos.y + gap\n    }), paths.push({\n      x: $endPos.x - offGap,\n      y: $endPos.y + gap\n    }), paths.push({\n      x: $endPos.x,\n      y: $endPos.y + gap\n    })) : (this.nodeA.cy > this.nodeZ.cy && (offGap = -offGap), paths.push({\n      x: $startPos.x + gap,\n      y: $startPos.y\n    }), paths.push({\n      x: $startPos.x + gap,\n      y: $startPos.y + offGap\n    }), paths.push({\n      x: $endPos.x + gap,\n      y: $endPos.y - offGap\n    }), paths.push({\n      x: $endPos.x + gap,\n      y: $endPos.y\n    })),\n      paths;\n  };\n}\n\n/**\n * 曲线状物\n *\n * @param {any} nodeA 节点A\n * @param {any} nodeZ 节点B\n * @param {any} text link名称\n */\nfunction CurveLink(nodeA, nodeZ, text) {\n  this.initialize = function() {\n    CurveLink.prototype.initialize.apply(this, arguments);\n  },\n  this.initialize(nodeA, nodeZ, text),\n  this.paintPath = function(ctx, paths) {\n    if (this.nodeA === this.nodeZ) {\n      return void this.paintLoop(ctx);\n    }\n    ctx.beginPath(),\n      ctx.moveTo(paths[0].x, paths[0].y);\n    for (let i = 1; i < paths.length; i++) {\n      let prevLink = paths[i - 1],\n        nextLink = paths[i],\n        distanceX = (prevLink.x + nextLink.x) / 2,\n        distanceY = (prevLink.y + nextLink.y) / 2;\n      distanceY += (nextLink.y - prevLink.y) / 2,\n        ctx.strokeStyle = 'rgba(' + this.strokeColor + ',' + this.alpha + ')',\n        ctx.lineWidth = this.lineWidth,\n        ctx.moveTo(prevLink.x, prevLink.cy),\n        ctx.quadraticCurveTo(distanceX, distanceY, nextLink.x, nextLink.y),\n        ctx.stroke();\n    }\n    ctx.stroke();\n    ctx.closePath();\n    if (null != this.arrowsRadius) {\n      let path_last_2 = paths[paths.length - 2],\n        path_last = paths[paths.length - 1];\n      this.paintArrow(ctx, path_last_2, path_last);\n    }\n  };\n}\n\nLink.prototype = new InteractiveElement,\n  FoldLink.prototype = new Link,\n  FlexionalLink.prototype = new Link,\n  CurveLink.prototype = new Link;\n\n// 单独导出\nmodule.exports = {\n  Link: Link,\n  FoldLink: FoldLink,\n  FlexionalLink: FlexionalLink,\n  CurveLink: CurveLink\n};\n"]}