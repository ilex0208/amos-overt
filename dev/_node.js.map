{"version":3,"sources":["../src/_node.js"],"names":["Tobj","require","_e","Util","EditableElement","AbstractNode","nodeText","initialize","text","prototype","apply","arguments","elementType","zIndex","zIndex_Node","font","fontColor","borderWidth","borderColor","borderRadius","dragable","textPosition","textOffsetX","textOffsetY","transformAble","inLinks","outLinks","properties","split","serializedProperties","concat","paint","ctx","image","$globalAlpha","globalAlpha","alpha","alarmImage","alarm","drawImage","width","height","beginPath","fillStyle","fillColor","rect","AmostRoundRect","fill","closePath","paintText","paintBorder","paintCtrl","paintAlarmText","tempAlarmColor","alarmColor","tempAlarmAlpha","alarmAlpha","alarmFont","alarmW","measureText","defaultW","$x","$y","strokeStyle","lineCap","lineWidth","moveTo","lineTo","stroke","fillText","tempText","tempTextW","textPos","getTextPostion","x","y","bW","posType","_w","_h","posResult","setImage","img","isSelfSize","Error","_tempSelf","imageCache","Image","src","onload","setSize","setImageByOpts","alarmImgOps","alarmImg","genImageAlarmByOpts","removeHandler","$scene","forEach","oLink","nodeA","remove","iLink","nodeZ","Node","TextNode","LinkNode","href","tar","target","isVisited","visitedColor","isMouseOver","mousemove","cav","document","getElementsByTagName","length","i","style","cursor","mouseout","click","window","open","location","CircleNode","_radius","beginDegree","endDegree","Math","PI","save","arc","radius","restore","paintSelected","DefaultAnimateNode","imgs","delay","isImageSize","frameImages","frameIndex","isStop","millsec","repeatPlay","_self","nextFrame","setTimeout","CustomAnimateNode","imgSrc","row","column","offset","isPause","swidth","sheight","sy","floor","sx","AnimateNode","_anode","stop","play","Object","defineProperties","get","_alarmColor","set","ac","generateImageAlarm","a","b","c","_width","_height","module","exports"],"mappings":"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","file":"_node.js","sourcesContent":["//////////////////////////////\n/**\n * node\n * @author ilex\n * @description 2016-12-01 11:56:12\n */\n//////////////////////////////\n\nconst Tobj = require('./_tobj');\nconst _e = require('./_baseElement');\nconst Util = require('./_util');\n// 获取可编辑element\nconst EditableElement = _e.EditableElement;\n/**\n * 抽象node,基类\n *\n * @param {any} nodeText\n */\nfunction AbstractNode(nodeText) {\n  this.initialize = function(text) {\n    AbstractNode.prototype.initialize.apply(this, arguments),\n      this.elementType = 'node',\n      this.zIndex = Tobj.zIndex_Node,\n      this.text = text,\n      this.font = '12px Consolas',\n      this.fontColor = '255,255,255',\n      this.borderWidth = 0,\n      this.borderColor = '255,255,255',\n      this.borderRadius = null,\n      this.dragable = true,\n      this.textPosition = 'Bottom_Center',\n      this.textOffsetX = 0,\n      this.textOffsetY = 0,\n      this.transformAble = true,\n      this.inLinks = null,\n      this.outLinks = null;\n    let properties = 'text,font,fontColor,textPosition,textOffsetX,textOffsetY,borderRadius'.split(',');\n    this.serializedProperties = this.serializedProperties.concat(properties);\n  },\n  this.initialize(nodeText),\n  this.paint = function(ctx) {\n    if (this.image) {\n      let $globalAlpha = ctx.globalAlpha;\n      ctx.globalAlpha = this.alpha;\n      if(null != this.alarmImage && null != this.alarm){\n        ctx.drawImage(this.alarmImage, -this.width / 2, -this.height / 2, this.width, this.height);\n      }else{\n        ctx.drawImage(this.image, -this.width / 2, -this.height / 2, this.width, this.height);\n      }\n      // null != this.alarmImage && null != this.alarm ? ctx.drawImage(this.alarmImage, -this.width / 2, -this.height / 2, this.width, this.height) : ctx.drawImage(this.image, -this.width / 2, -this.height / 2, this.width, this.height);\n      ctx.globalAlpha = $globalAlpha;\n    } else {\n      ctx.beginPath();\n      ctx.fillStyle = 'rgba(' + this.fillColor + ',' + this.alpha + ')';\n      if(null == this.borderRadius || 0 == this.borderRadius){\n        ctx.rect(- this.width / 2, -this.height / 2, this.width, this.height);\n      }else{\n        ctx.AmostRoundRect(- this.width / 2, -this.height / 2, this.width, this.height, this.borderRadius);\n      }\n      // null == this.borderRadius || 0 == this.borderRadius ? ctx.rect(- this.width / 2, -this.height / 2, this.width, this.height) : ctx.AmostRoundRect(- this.width / 2, -this.height / 2, this.width, this.height, this.borderRadius);\n      ctx.fill();\n      ctx.closePath();\n    }\n    this.paintText(ctx);\n    this.paintBorder(ctx);\n    this.paintCtrl(ctx);\n    this.paintAlarmText(ctx);\n  },\n  this.paintAlarmText = function(ctx) {\n    if (null != this.alarm && '' != this.alarm) {\n      let tempAlarmColor = this.alarmColor || '255,0,0',\n        tempAlarmAlpha = this.alarmAlpha || 0.5;\n      ctx.beginPath(),\n        ctx.font = this.alarmFont || '10px 微软雅黑';\n      let alarmW = ctx.measureText(this.alarm).width + 6,\n        defaultW = ctx.measureText('田').width + 6,\n        $x = this.width / 2 - alarmW / 2,\n        $y = -this.height / 2 - defaultW - 8;\n      ctx.strokeStyle = 'rgba(' + tempAlarmColor + ', ' + tempAlarmAlpha + ')',\n        ctx.fillStyle = 'rgba(' + tempAlarmColor + ', ' + tempAlarmAlpha + ')',\n        ctx.lineCap = 'round',\n        ctx.lineWidth = 1,\n        ctx.moveTo($x, $y),\n        ctx.lineTo($x + alarmW, $y),\n        ctx.lineTo($x + alarmW, $y + defaultW),\n        ctx.lineTo($x + alarmW / 2 + 6, $y + defaultW),\n        ctx.lineTo($x + alarmW / 2, $y + defaultW + 8),\n        ctx.lineTo($x + alarmW / 2 - 6, $y + defaultW),\n        ctx.lineTo($x, $y + defaultW),\n        ctx.lineTo($x, $y),\n        ctx.fill(),\n        ctx.stroke(),\n        ctx.closePath(),\n        ctx.beginPath(),\n        ctx.strokeStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')',\n        ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')',\n        ctx.fillText(this.alarm, $x + 2, $y + defaultW - 4),\n        ctx.closePath();\n    }\n  },\n  this.paintText = function(ctx) {\n    let tempText = this.text;\n    if (null != tempText && '' != tempText) {\n      ctx.beginPath(),\n        ctx.font = this.font;\n      let tempTextW = ctx.measureText(tempText).width,\n        defaultW = ctx.measureText('田').width;\n      ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')';\n      let textPos = this.getTextPostion(this.textPosition, tempTextW, defaultW);\n      ctx.fillText(tempText, textPos.x, textPos.y),\n        ctx.closePath();\n    }\n  },\n  this.paintBorder = function(ctx) {\n    if (0 != this.borderWidth) {\n      ctx.beginPath(),\n        ctx.lineWidth = this.borderWidth,\n        ctx.strokeStyle = 'rgba(' + this.borderColor + ',' + this.alpha + ')';\n      let bW = this.borderWidth / 2;\n      null == this.borderRadius || 0 == this.borderRadius ? ctx.rect(- this.width / 2 - bW, -this.height / 2 - bW, this.width + this.borderWidth, this.height + this.borderWidth) : ctx.AmostRoundRect(- this.width / 2 - bW, -this.height / 2 - bW, this.width + this.borderWidth, this.height + this.borderWidth, this.borderRadius),\n        ctx.stroke(),\n        ctx.closePath();\n    }\n  },\n  this.getTextPostion = function(posType, _w, _h) {\n    let posResult = null;\n    return null == posType || 'Bottom_Center' == posType ? posResult = {\n      x: -this.width / 2 + (this.width - _w) / 2,\n      y: this.height / 2 + _h\n    } : 'Top_Center' == posType ? posResult = {\n      x: -this.width / 2 + (this.width - _w) / 2,\n      y: -this.height / 2 - _h / 2\n    } : 'Top_Right' == posType ? posResult = {\n      x: this.width / 2,\n      y: -this.height / 2 - _h / 2\n    } : 'Top_Left' == posType ? posResult = {\n      x: -this.width / 2 - _w,\n      y: -this.height / 2 - _h / 2\n    } : 'Bottom_Right' == posType ? posResult = {\n      x: this.width / 2,\n      y: this.height / 2 + _h\n    } : 'Bottom_Left' == posType ? posResult = {\n      x: -this.width / 2 - _w,\n      y: this.height / 2 + _h\n    } : 'Middle_Center' == posType ? posResult = {\n      x: -this.width / 2 + (this.width - _w) / 2,\n      y: _h / 2\n    } : 'Middle_Right' == posType ? posResult = {\n      x: this.width / 2,\n      y: _h / 2\n    } : 'Middle_Left' == posType && (posResult = {\n      x: -this.width / 2 - _w,\n      y: _h / 2\n    }),\n      null != this.textOffsetX && (posResult.x += this.textOffsetX),\n      null != this.textOffsetY && (posResult.y += this.textOffsetY),\n      posResult;\n  },\n  /**\n   * node节点设置image\n   * @param {any} img 可以是image路径,也可以是Image对象\n   * @param {boolean} isSelfSize 是否是image自身大小\n   */\n    this.setImage = function(img, isSelfSize) {\n      if (null == img) {throw new Error('Node.setImage(): 参数Image对象为空!');}\n      var _tempSelf = this;\n      if ('string' == typeof img) {\n        var image = imageCache[img];\n        null == image ? (\n          image = new Image, image.src = img, image.onload = function() {\n            imageCache[img] = image,\n            true === isSelfSize && _tempSelf.setSize(image.width, image.height),\n            _tempSelf.image = image,\n            _tempSelf.alarmColor = null == _tempSelf.alarmColor ? '255,0,0': _tempSelf.alarmColor;\n          }\n        ) : (\n          isSelfSize && this.setSize(image.width, image.height),\n          _tempSelf.image = image,\n          _tempSelf.alarmColor = null == _tempSelf.alarmColor ? '255,0,0': _tempSelf.alarmColor\n        );\n      } else {\n        this.image = img,\n          _tempSelf.alarmColor = null == _tempSelf.alarmColor ? '255,0,0': _tempSelf.alarmColor,\n          true === isSelfSize && this.setSize(img.width, img.height);\n      }\n    },\n    /**\n   * node节点设置image\n   * @param {any} img 可以是image路径,也可以是Image对象\n   * @param {boolean} isSelfSize 是否是image自身大小\n   * @param {Object} alarmImgOps 自定义告警属性\n   */\n  this.setImageByOpts = function(img, isSelfSize, alarmImgOps) {\n    if (null == img) {throw new Error('Node.setImage(): 参数Image对象为空!');}\n    let _tempSelf = this;\n    if ('string' == typeof img) {\n      let image = imageCache[img];\n      null == image ? (image = new Image, image.src = img, image.onload = function() {\n        imageCache[img] = image,\n          true === isSelfSize && _tempSelf.setSize(image.width, image.height);\n        let alarmImg = Util.genImageAlarmByOpts(image, alarmImgOps);\n        alarmImg && (image.alarm = alarmImg),\n          _tempSelf.image = image;\n      }) : (isSelfSize && this.setSize(image.width, image.height), this.image = image);\n    } else {\n      this.image = img,\n      true === isSelfSize && this.setSize(img.width, img.height);\n    }\n  },\n  this.removeHandler = function($scene) {\n    let _tempSelf = this;\n    this.outLinks && (this.outLinks.forEach(function(oLink) {\n      oLink.nodeA === _tempSelf && $scene.remove(oLink);\n    }), this.outLinks = null),\n      this.inLinks && (this.inLinks.forEach(function(iLink) {\n        iLink.nodeZ === _tempSelf && $scene.remove(iLink);\n      }), this.inLinks = null);\n  };\n}\n\n/**\n * 普通node\n */\nfunction Node() {\n  Node.prototype.initialize.apply(this, arguments);\n}\n\n/**\n *带text node\n *\n * @param {any} a\n */\nfunction TextNode(text) {\n  this.initialize(),\n    this.text = text,\n    this.elementType = 'TextNode',\n    this.paint = function(ctx) {\n      ctx.beginPath(),\n        ctx.font = this.font,\n        this.width = ctx.measureText(this.text).width,\n        this.height = ctx.measureText('田').width,\n        ctx.strokeStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')',\n        ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')',\n        ctx.fillText(this.text, -this.width / 2, this.height / 2),\n        ctx.closePath(),\n        this.paintBorder(ctx),\n        this.paintCtrl(ctx),\n        this.paintAlarmText(ctx);\n    };\n}\n\n/**\n * 带超链接的node\n *\n * @param {any} text 显示文本\n * @param {any} href 超链接\n * @param {any} tar a标签的target属性  _blank || _parent || _self || _top\n */\nfunction LinkNode(text, href, tar) {\n  this.initialize(),\n  this.text = text,\n  this.href = href,\n  this.target = tar,\n  this.elementType = 'LinkNode',\n  this.isVisited = false,\n  this.visitedColor = null,\n  this.paint = function(ctx) {\n    ctx.beginPath(),\n      ctx.font = this.font,\n      this.width = ctx.measureText(this.text).width,\n      this.height = ctx.measureText('田').width;\n    if(this.isVisited && null != this.visitedColor){\n      ctx.strokeStyle = 'rgba(' + this.visitedColor + ', ' + this.alpha + ')';\n      ctx.fillStyle = 'rgba(' + this.visitedColor + ', ' + this.alpha + ')';\n    }else{\n      ctx.strokeStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')';\n      ctx.fillStyle = 'rgba(' + this.fontColor + ', ' + this.alpha + ')';\n    }\n    ctx.fillText(this.text, -this.width / 2, this.height / 2);\n    if(this.isMouseOver){\n      ctx.moveTo(- this.width / 2, this.height);\n      ctx.lineTo(this.width / 2, this.height);\n      ctx.stroke();\n    }\n    ctx.closePath(),\n      this.paintBorder(ctx),\n      this.paintCtrl(ctx),\n      this.paintAlarmText(ctx);\n  },\n  this.mousemove(function() {\n    let cav = document.getElementsByTagName('canvas');\n    if (cav && cav.length > 0) {\n      for (let i = 0; i < cav.length; i++) {\n        cav[i].style.cursor = 'pointer';\n      }\n    }\n  }),\n  this.mouseout(function() {\n    let cav = document.getElementsByTagName('canvas');\n    if (cav && cav.length > 0) {\n      for (let i = 0; i < cav.length; i++) {\n        cav[i].style.cursor = 'default';\n      }\n    }\n  }),\n  this.click(function() {\n    '_blank' == this.target ? window.open(this.href) : location = this.href,\n      this.isVisited = true;\n  });\n}\n\n/**\n * 圆形node\n *\n * @param {any} text\n */\nfunction CircleNode(text) {\n  this.initialize(arguments),\n  this._radius = 20,\n  this.beginDegree = 0,\n  this.endDegree = 2 * Math.PI,\n  this.text = text,\n  this.paint = function(ctx) {\n    ctx.save(),\n      ctx.beginPath(),\n      ctx.fillStyle = 'rgba(' + this.fillColor + ',' + this.alpha + ')',\n      ctx.arc(0, 0, this.radius, this.beginDegree, this.endDegree, true),\n      ctx.fill(),\n      ctx.closePath(),\n      ctx.restore(),\n      this.paintText(ctx),\n      this.paintBorder(ctx),\n      this.paintCtrl(ctx),\n      this.paintAlarmText(ctx);\n  },\n  this.paintSelected = function(ctx) {\n    ctx.save(),\n      ctx.beginPath(),\n      ctx.strokeStyle = 'rgba(168,202,255, 0.9)',\n      ctx.fillStyle = 'rgba(168,202,236,0.7)',\n      ctx.arc(0, 0, this.radius + 3, this.beginDegree, this.endDegree, true),\n      ctx.fill(),\n      ctx.stroke(),\n      ctx.closePath(),\n      ctx.restore();\n  };\n}\n\n/**\n * 创建默认动画node\n *\n * @param {any} imgs img集合\n * @param {any} delay 执行间隔时间\n * @param {any} isImageSize\n */\nfunction DefaultAnimateNode(imgs, delay, isImageSize) {\n  this.initialize(),\n    this.frameImages = imgs || [],\n    this.frameIndex = 0,\n    this.isStop = true;\n  let millsec = delay || 1000;\n  this.repeatPlay = false;\n  let _self = this;\n  this.nextFrame = function() {\n    if (!this.isStop && null != this.frameImages.length) {\n      if (this.frameIndex++ , this.frameIndex >= this.frameImages.length) {\n        if (!this.repeatPlay) {return;}\n        this.frameIndex = 0;\n      }\n      this.setImage(this.frameImages[this.frameIndex], isImageSize),\n        setTimeout(function() {\n          _self.nextFrame();\n        },\n          millsec / imgs.length);\n    }\n  };\n}\n\n/**\n * 用户自定义动画node\n *\n * @param {any} imgSrc\n * @param {any} row 行\n * @param {any} c 列\n * @param {any} d\n * @param {any} offset 行偏移量\n */\nfunction CustomAnimateNode(imgSrc, row, column, delay, offset) {\n  this.initialize();\n  let _self = this;\n  this.setImage(imgSrc),\n    this.frameIndex = 0,\n    this.isPause = true,\n    this.repeatPlay = false;\n  let millsec = delay || 1000;\n  offset = offset || 0,\n    this.paint = function(ctx) {\n      if (this.image) {\n        let swidth = this.width, // 被剪切图像的宽度\n          sheight = this.height; // 被剪切图像的高度\n        ctx.save(),\n          ctx.beginPath(),\n          ctx.fillStyle = 'rgba(' + this.fillColor + ',' + this.alpha + ')';\n        let sy = (Math.floor(this.frameIndex / column) + offset) * sheight, // 开始剪切的 y 坐标位置\n          sx = Math.floor(this.frameIndex % column) * swidth;// 开始剪切的 x 坐标位置\n        ctx.drawImage(this.image, sx, sy, swidth, sheight, -swidth / 2, -sheight / 2, swidth, sheight),\n          ctx.fill(),\n          ctx.closePath(),\n          ctx.restore(),\n          this.paintText(ctx),\n          this.paintBorder(ctx),\n          this.paintCtrl(ctx),\n          this.paintAlarmText(ctx);\n      }\n    },\n    this.nextFrame = function() {\n      if (!this.isStop) {\n        if (this.frameIndex++ , this.frameIndex >= row * column) {\n          if (!this.repeatPlay) {return;}\n          this.frameIndex = 0;\n        }\n        setTimeout(function() {\n          _self.isStop || _self.nextFrame();\n        },\n          millsec / (row * column));\n      }\n    };\n}\n\n/**\n * AnimateNode\n *\n * @returns\n */\nfunction AnimateNode() {\n  let _anode = null;\n  return _anode = arguments.length <= 3 ? new DefaultAnimateNode(arguments[0], arguments[1], arguments[2]) : new CustomAnimateNode(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]),\n    _anode.stop = function() {\n      _anode.isStop = true;\n    },\n    _anode.play = function() {\n      _anode.isStop = false,\n        _anode.frameIndex = 0,\n        _anode.nextFrame();\n    },\n    _anode;\n}\n\nlet imageCache = {};\n\nAbstractNode.prototype = new EditableElement,\n  Node.prototype = new AbstractNode,\n  Object.defineProperties(Node.prototype, {\n    alarmColor: {\n      get: function() {\n        return this._alarmColor;\n      },\n      set: function(ac) {\n        this._alarmColor = ac;\n        if (null != this.image) {\n          var alarmImg = Util.generateImageAlarm(this.image, ac);\n          alarmImg && (this.alarmImage = alarmImg);\n        }\n      }\n    }\n  }),\n  TextNode.prototype = new Node,\n  LinkNode.prototype = new TextNode,\n  CircleNode.prototype = new Node;\n\nObject.defineProperties(CircleNode.prototype, {\n  radius: {\n    get: function() {\n      return this._radius;\n    },\n    set: function(a) {\n      this._radius = a;\n      let b = 2 * this.radius,\n        c = 2 * this.radius;\n      this.width = b,\n        this.height = c;\n    }\n  },\n  width: {\n    get: function() {\n      return this._width;\n    },\n    set: function(a) {\n      this._radius = a / 2,\n        this._width = a;\n    }\n  },\n  height: {\n    get: function() {\n      return this._height;\n    },\n    set: function(a) {\n      this._radius = a / 2,\n        this._height = a;\n    }\n  }\n});\n\nDefaultAnimateNode.prototype = new Node,\nCustomAnimateNode.prototype = new Node,\nAnimateNode.prototype = new Node;\n\n// 单独导出\nmodule.exports = {\n  Node: Node,\n  TextNode: TextNode,\n  LinkNode: LinkNode,\n  CircleNode: CircleNode,\n  AnimateNode: AnimateNode\n};\n"]}