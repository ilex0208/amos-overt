{"version":3,"sources":["../src/_animate.js"],"names":["_n","require","Util","Node","isStopAll","Step","fn","millisec","interval","msgBus","stop","window","clearInterval","publish","start","_self","setInterval","call","onStop","msg","MessageBus","subscribe","gravity","node","option","_context","context","t","effect","run","dx","dy","y","height","stage","canvas","setLocation","x","f","stepByStep","tarEle","animate","speed","isCycle","isReverse","$ani","key","val","total","oldValue","targetValue","step","isDone","property","result","$step","flag","akey","reKey","currentVal","spring","dest","$spring","$friction","friction","$dgrivity","grivity","windOrLength","wind","minLength","items","timer","isPause","addNode","trNode","tr","animateNode","target","vx","vy","push","play","nextFrame","i","length","$node","$target","$vx","$vy","distanceX","distanceY","angle","Math","atan2","_width","cos","_height","sin","rotate","v","PI","dividedTwoPiece","genNode","r","beginDegree","endDegree","newNode","setImage","image","setSize","width","draw","ctx","save","arc","clip","beginPath","undefined","drawImage","fillStyle","style","alpha","rect","fill","closePath","restore","split","node1","node2","random","visible","add","n","remove","repeatThrow","initNode","setVisible","$width","stopAll","startAll","cycle","p1","p2","midX","midY","distance","getDistance","newy","move","pos","position","easing","scale","quantity","oldScaleX","scaleX","oldScaleY","scaleY","Animate","Effect","module","exports"],"mappings":"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","file":"_animate.js","sourcesContent":["//////////////////////////////\n/**\n * 动画\n * @author ilex\n * @description 2016-11-01 11:56:12\n */\n//////////////////////////////\nconst _n = require('./_node');\nconst Util = require('./_util');\nconst Node = _n.Node;\n/**\n * 标志是否停止所有\n */\nlet isStopAll = false;\n\n/**\n * 动画步骤\n *\n * @param {any} fn 执行动画的函数\n * @param {any} millisec 执行时间 毫秒\n * @returns 动画本身\n */\nfunction Step(fn, millisec) {\n  let interval, msgBus = null;\n  return {\n    stop: function() {\n      return interval ? (window.clearInterval(interval), msgBus && msgBus.publish('stop'), this) : this;\n    },\n    start: function() {\n      let _self = this;\n      return interval = setInterval(function() {fn.call(_self);}, millisec),this;\n    },\n    onStop: function(msg) {\n      return null == msgBus && (msgBus = new Util.MessageBus),\n        msgBus.subscribe('stop', msg),\n        this;\n    }\n  };\n}\n\n/**\n * gravity动画\n * (重力效果)\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction gravity(node, option) {\n  let _context = option.context;\n  let gravity = option.gravity || 0.1;\n  let t = null;\n  let effect = {};\n\n  function stop() {\n    window.clearInterval(t);\n    if (effect.onStop) {\n      effect.onStop(node);\n    }\n    return effect;\n  }\n\n  function run() {\n    let dx = option.dx || 0,\n      dy = option.dy || 2;\n    t = setInterval(function() {\n      if (isStopAll) {\n        effect.stop();\n        return;\n      }\n      dy += gravity;\n      if (node.y + node.height < _context.stage.canvas.height) {\n        node.setLocation(node.x + dx, node.y + dy);\n      } else {\n        dy = 0;\n        stop();\n      }\n    }, 20);\n    return effect;\n  }\n\n  effect.run = run;\n  effect.stop = stop;\n  effect.onStop = function(f) {\n    effect.onStop = f;\n    return effect;\n  };\n  return effect;\n}\n\n/**\n * 分步骤执行动画\n *\n * @param {any} tarEle 动画元素,可以是node、scene\n * @param {object} animates 动画 如:{rotate: 2*Math.PI}/{scalaX: 2}/{percent: 1}\n *\t\t\t\t/{height:150, y: 70}/{alpha: 0.2}/{x: 300, y: 400, width: 10, height: 10, rotate: 2*Math.PI} 等\n * @param {number} speed 速度\n * @param {boolean} isCycle 是否持续执行动画 true: 持续执行  false:不持续执行 (false时可以不写参数)\n * @param {boolean} isReverse 是否是否反向回滚动画 true: 反向执行  false:不反向 (其中为false的时候可以不写)\n * @author ilex\n * @description exp : stepByStep(scene, {translateX: location.x, translateY: location.y, scaleX: 4, scaleY: 4}, 600).start()\n */\nfunction stepByStep(tarEle, animate, speed, isCycle, isReverse) {\n  let millisec = 1000 / 24, $ani = {};\n  for (let key in animate) {\n    let val = animate[key],\n      total = val - tarEle[key];\n    $ani[key] = {\n      oldValue: tarEle[key],\n      targetValue: val,\n      step: total / speed * millisec,\n      isDone: function(property) {\n        let result = this.step > 0 && tarEle[property] >= this.targetValue || this.step < 0 && tarEle[property] <= this.targetValue;\n        return result;\n      }\n    };\n  }\n  let $step = new Step(function() {\n    let flag = true;\n    for (let akey in animate) {\n      $ani[akey].isDone(akey) || (tarEle[akey] += $ani[akey].step, flag = false);\n    }\n    if (flag) {\n      if (!isCycle) {\n        return this.stop();\n      }\n      for (let reKey in animate) {\n        if (isReverse) {\n          let currentVal = $ani[reKey].targetValue;\n          $ani[reKey].targetValue = $ani[reKey].oldValue,\n              $ani[reKey].oldValue = currentVal,\n              $ani[reKey].step = -$ani[reKey].step;\n        } else {\n          tarEle[reKey] = $ani[reKey].oldValue;\n        }\n      }\n    }\n    return this;\n  },\n    millisec);\n  return $step;\n}\n\n/**\n * 跳跃动画\n * (效果)\n *\n * @param {any} dest 执行动画的目标\n * @returns\n */\nfunction spring(dest) {\n  null == dest && (dest = {});\n  let $spring = dest.spring || 0.1,\n    $friction = dest.friction || 0.8, // 摩擦力\n    $dgrivity = dest.grivity || 0, // 引力\n    windOrLength = (dest.wind || 0, dest.minLength || 0);\n  return {\n    items: [],\n    timer: null,\n    isPause: false,\n    addNode: function(trNode, tr) {\n      let animateNode = {\n        node: trNode,\n        target: tr,\n        vx: 0,\n        vy: 0\n      };\n      return this.items.push(animateNode), this;\n    },\n    play: function(speed) {\n      this.stop(), speed = null == speed ? 1000 / 24 : speed;\n      let _self = this;\n      this.timer = setInterval(function() { _self.nextFrame(); }, speed);\n    },\n    stop: function() {\n      null != this.timer && window.clearInterval(this.timer);\n    },\n    nextFrame: function() {\n      for (let i = 0; i < this.items.length; i++) {\n        let animateNode = this.items[i],\n          $node = animateNode.node,\n          $target = animateNode.target,\n          $vx = animateNode.vx,\n          $vy = animateNode.vy,\n          distanceX = $target.x - $node.x,\n          distanceY = $target.y - $node.y,\n          angle = Math.atan2(distanceY, distanceX); // 反正切\n        if (0 != windOrLength) {\n          let _width = $target.x - Math.cos(angle) * windOrLength,\n            _height = $target.y - Math.sin(angle) * windOrLength;\n          $vx += (_width - $node.x) * $spring,\n            $vy += (_height - $node.y) * $spring;\n        } else {\n          $vx += distanceX * $spring,\n            $vy += distanceY * $spring;\n        }\n        $vx *= $friction,\n          $vy *= $friction,\n          $vy += $dgrivity,\n          $node.x += $vx,\n          $node.y += $vy,\n          animateNode.vx = $vx,\n          animateNode.vy = $vy;\n      }\n    }\n  };\n}\n\n/**\n * 旋转动画\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction rotate(node, option) {\n  // let _context = option.context;\n  let t = null;\n  let effect = {};\n  let v = option.v;\n\n  function run() {\n    t = setInterval(function() {\n      if (isStopAll) {\n        effect.stop();\n        return;\n      }\n      node.rotate += v || 0.2;\n      if (node.rotate > 2 * Math.PI) {\n        node.rotate = 0;\n      }\n    }, 100);\n    return effect;\n  }\n\n  function stop() {\n    window.clearInterval(t);\n    if (effect.onStop) {\n      effect.onStop(node);\n    }\n    return effect;\n  }\n\n  effect.run = run;\n  effect.stop = stop;\n  effect.onStop = function(fn) {\n    effect.onStop = fn;\n    return effect;\n  };\n  return effect;\n}\n\n/**\n * 分裂成两瓣动画\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction dividedTwoPiece(node, option) {\n  let _context = option.context;\n  // let style = node.style;\n  let effect = {};\n\n  function genNode(x, y, r, beginDegree, endDegree) {\n    let newNode = new Node();\n    newNode.setImage(node.image);\n    newNode.setSize(node.width, node.height);\n    newNode.setLocation(x, y);\n    newNode.draw = function(ctx) {\n      ctx.save();\n      // ctx.arc(this.x + this.width / 2, this.y + this.height / 2, r, beginDegree, endDegree);\n      ctx.arc(0, 0, r, beginDegree, endDegree);\n      ctx.clip();\n      ctx.beginPath();\n      if (this.image != undefined && this.image != null) {\n        ctx.drawImage(this.image, -this.width / 2, -this.height / 2);\n      } else {\n        ctx.fillStyle = 'rgba(' + this.style.fillStyle + ',' + this.alpha + ')';\n        ctx.rect(-this.width / 2, -this.height / 2, this.width / 2, this.height / 2);\n        ctx.fill();\n      }\n      ctx.closePath();\n      ctx.restore();\n    };\n    return newNode;\n  }\n\n  function split(angle, ctx) {\n    let beginDegree = angle;\n    let endDegree = angle + Math.PI;\n    let node1 = genNode(node.x, node.y, node.width, beginDegree, endDegree);\n    let node2 = genNode(node.x - 2 + Math.random() * 4, node.y, node.width, beginDegree + Math.PI, beginDegree);\n    // node.setVisible(false);\n    node.visible = false;\n\n    ctx.add(node1);\n    ctx.add(node2);\n    // box.updateView();\n\n    gravity(node1, {\n      context: ctx,\n      dx: 0.3\n    }).run().onStop(function(n) {\n      ctx.remove(node1);\n      ctx.remove(node2);\n      effect.stop();\n    });\n    gravity(node2, {\n      context: ctx,\n      dx: -0.2\n    }).run();\n  }\n\n  function run() {\n    split(option.angle, _context);\n    return effect;\n  }\n\n  function stop() {\n    if (effect.onStop) {\n      effect.onStop(node);\n    }\n    return effect;\n  }\n\n  effect.onStop = function(fn) {\n    effect.onStop = fn;\n    return effect;\n  };\n  effect.run = run;\n  effect.stop = stop;\n  return effect;\n}\n\n/**\n * 重复投掷动画\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction repeatThrow(node, option) {\n  let gravity = 0.8,\n    ctx = option.context,\n    t = null,\n    effect = {};\n\n  function initNode(node) {\n    node.setVisible(true);\n    node.rotate = Math.random();\n    let $width = ctx.stage.canvas.width / 2;\n    node.x = $width + Math.random() * ($width - 100) - Math.random() * ($width - 100);\n    node.y = ctx.stage.canvas.height;\n    node.vx = Math.random() * 5 - Math.random() * 5;\n    node.vy = -25;\n  }\n\n  function run() {\n    initNode(node);\n    t = setInterval(function() {\n      if (isStopAll) {\n        effect.stop();\n        return;\n      }\n      node.vy += gravity;\n      node.x += node.vx;\n      node.y += node.vy;\n      if (node.x < 0 || node.x > ctx.stage.canvas.width || node.y > ctx.stage.canvas.height) {\n        if (effect.onStop) {\n          effect.onStop(node);\n        }\n        initNode(node);\n      }\n    }, 50);\n    return effect;\n  }\n\n  function stop() {\n    window.clearInterval(t);\n  }\n\n  effect.onStop = function(fn) {\n    effect.onStop = fn;\n    return effect;\n  };\n  effect.run = run;\n  effect.stop = stop;\n  return effect;\n}\n\n/**\n * 停止所有\n */\nfunction stopAll() {\n  isStopAll = true;\n}\n\n/**\n * 开启所有\n */\nfunction startAll() {\n  isStopAll = false;\n}\n\n/**\n * 周期动画\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction cycle(node, option) {\n  let p1 = option.p1;\n  let p2 = option.p2;\n  // let box = option.context;\n\n  let midX = p1.x + (p2.x - p1.x) / 2;\n  let midY = p1.y + (p2.y - p1.y) / 2;\n  let distance = Util.getDistance(p1, p2) / 2;\n\n  let angle = Math.atan2(midY, midX);// 角度\n  let speed = option.speed || 0.2;// 角度增加量\n  let effect = {};\n  let t = null;\n\n  function run() {\n    t = setInterval(function() {\n      if (isStopAll) {\n        effect.stop();\n        return;\n      }\n      //let newx = p1.x + midX + Math.cos(angle) * distance;\n      let newy = p1.y + midX + Math.sin(angle) * distance;\n      node.setLocation(node.x, newy);\n      // box.updateView();\n      angle += speed;\n    }, 100);\n    return effect;\n  }\n\n  function stop() {\n    window.clearInterval(t);\n  }\n\n  effect.run = run;\n  effect.stop = stop;\n  return effect;\n}\n\n/**\n * 移动\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction move(node, option) {\n  let pos = option.position;\n  // let box = option.context;\n  let easing = option.easing || 0.2;\n\n  let effect = {};\n  let t = null;\n\n  function run() {\n    t = setInterval(function() {\n      if (isStopAll) {\n        effect.stop();\n        return;\n      }\n      let dx = pos.x - node.x;\n      let dy = pos.y - node.y;\n      let vx = dx * easing;\n      let vy = dy * easing;\n\n      node.x += vx;\n      node.y += vy;\n      // box.updateView();\n      if (vx < 0.01 && vy < 0.1) {\n        stop();\n      }\n    }, 100);\n    return effect;\n  }\n\n  function stop() {\n    window.clearInterval(t);\n  }\n  effect.onStop = function(f) {\n    effect.onStop = f;\n    return effect;\n  };\n  effect.run = run;\n  effect.stop = stop;\n  return effect;\n}\n\n/**\n * 目标自身缩放动画\n *\n * @param {any} node\n * @param {any} option\n * @returns\n */\nfunction scale(node, option) {\n  // let p = option.position;\n  // let box = option.context;\n  let scale = option.scale || 1;\n  let quantity = 0.06; // 增加量\n  let oldScaleX = node.scaleX;\n  let oldScaleY = node.scaleY;\n\n  let effect = {};\n  let t = null;\n\n  function run() {\n    t = setInterval(function() {\n      node.scaleX += quantity;\n      node.scaleY += quantity;\n      if (node.scaleX >= scale) {\n        stop();\n      }\n      // box.updateView();\n    }, 100);\n    return effect;\n  }\n\n  function stop() {\n    if (effect.onStop) {\n      effect.onStop(node);\n    }\n    node.scaleX = oldScaleX;\n    node.scaleY = oldScaleY;\n    window.clearInterval(t);\n  }\n  effect.onStop = function(f) {\n    effect.onStop = f;\n    return effect;\n  };\n  effect.run = run;\n  effect.stop = stop;\n  return effect;\n}\n\nlet Animate = {\n    stepByStep: stepByStep,\n    rotate: rotate,\n    scale: scale,\n    move: move,\n    cycle: cycle,\n    repeatThrow: repeatThrow,\n    dividedTwoPiece: dividedTwoPiece,\n    gravity: gravity,\n    startAll: startAll,\n    stopAll: stopAll\n  },\n  Effect = {\n    spring: spring,\n    gravity: gravity\n  };\n\n// 单独导出\nmodule.exports = {\n  Effect: Effect,\n  Animate: Animate\n};\n\n"]}