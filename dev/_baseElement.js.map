{"version":3,"sources":["../src/_baseElement.js"],"names":["Element","require","Util","Tobj","SceneMode","Constants","_default","DEFAULT","DisplayElement","initialize","prototype","apply","arguments","elementType","x","y","width","height","visible","alpha","rotate","scaleX","scaleY","strokeColor","borderColor","fillColor","shadow","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","transformAble","zIndex","properties","split","serializedProperties","concat","paint","ctx","beginPath","fillStyle","rect","fill","stroke","closePath","getLocation","setLocation","getCenterLocation","setCenterLocation","getSize","heith","setSize","getDimension","setDimension","dimension","_dimension","getBound","left","top","right","bottom","setBound","getDisplayBound","getDisplaySize","getPosition","pos","location","bound","cx","cy","InteractiveElement","dragable","selected","showSelected","selectedLocation","isMouseOver","paintSelected","save","strokeStyle","restore","paintMouseover","isInBound","Math","abs","selectedHandler","unselectedHandler","dbclickHandler","msg","dispatchEvent","clickHandler","mousedownHander","mouseupHandler","mouseoverHandler","mousemoveHandler","mouseoutHandler","mousedragHandler","dx","dy","addEventListener","topic","fn","_self","action","data","call","messageBus","MessageBus","subscribe","publish","removeEventListener","unsubscribe","removeAllEventListener","topics","self","forEach","EditableElement","editAble","selectedPoint","getCtrlPosition","$x","$y","$pos","_stage","selectedSize","scene","mode","edit","points","paintCtrl","i","length","ctrPos","$width","$heith","_left","_top","$ctrPos","tlWidth","tlHeight","tlX","tlY","tcHeight","tcY","trWidth","trY","mlWidth","mlX","mrWidth","blWidth","blX","blHeight","bcHeight","brWidth","brHeight","Object","defineProperties","get","set","value","module","exports"],"mappings":"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","file":"_baseElement.js","sourcesContent":["//////////////////////////////\n/**\n * 容器\n * @author ilex\n * @description 2016-11-04 11:56:12\n */\n//////////////////////////////\nconst Element = require('./_absElement');\nconst Util = require('./_util');\nconst Tobj = require('./_tobj');\nconst SceneMode = Tobj.SceneMode;\nconst Constants = require('./constants/index');\nconst _default = Constants.DEFAULT;\n\n/**\n * DisplayElement 对象\n */\nfunction DisplayElement() {\n  this.initialize = function() {\n    DisplayElement.prototype.initialize.apply(this, arguments),\n      this.elementType = 'displayElement',\n      this.x = 0,\n      this.y = 0,\n      this.width = 32,\n      this.height = 32,\n      this.visible = true,\n      this.alpha = 1,\n      this.rotate = 0,\n      this.scaleX = 1,\n      this.scaleY = 1,\n      this.strokeColor = '22,124,255',\n      this.borderColor = '22,124,255',\n      this.fillColor = '22,124,255',\n      this.shadow = false,\n      this.shadowBlur = 5,\n      this.shadowColor = 'rgba(0,0,0,0.5)',\n      this.shadowOffsetX = 3,\n      this.shadowOffsetY = 6,\n      this.transformAble = false,\n      this.zIndex = 0;\n    let properties = 'x,y,width,height,visible,alpha,rotate,scaleX,scaleY,strokeColor,fillColor,shadow,shadowColor,shadowOffsetX,shadowOffsetY,transformAble,zIndex'.split(',');\n    this.serializedProperties = this.serializedProperties.concat(properties);\n  },\n    this.initialize(),\n    this.paint = function(ctx) {\n      ctx.beginPath(),\n      ctx.fillStyle = 'rgba(' + this.fillColor + ',' + this.alpha + ')',\n      ctx.rect( - this.width / 2, -this.height / 2, this.width, this.height),\n      ctx.fill(),\n      ctx.stroke(),\n      ctx.closePath();\n    },\n    this.getLocation = function() {\n      return {\n        x: this.x,\n        y: this.y\n      };\n    },\n    this.setLocation = function(x, y) {\n      return this.x = x,\n      this.y = y,\n      this;\n    },\n    this.getCenterLocation = function() {\n      return {\n        x: this.x + this.width / 2,\n        y: this.y + this.height / 2\n      };\n    },\n    this.setCenterLocation = function(x, y) {\n      return this.x = x - this.width / 2,\n      this.y = y - this.height / 2,\n      this;\n    },\n    this.getSize = function() {\n      return {\n        width: this.width,\n        height: this.heith\n      };\n    },\n    this.setSize = function(width, height) {\n      this.width = width,\n        this.height = height;\n      return this;\n    },\n    this.getDimension = function(){\n      return {\n        width: this.width,\n        height: this.height\n      };\n    },\n    /**\n     * 4种取值\n     *  small: 25, middle: 35, large: 50, default: 32\n     * 针对node设置image以后,该值生效的前提是setImage中第二个参数为false或者不填写\n     */\n    this.setDimension = function(dimension){\n      let _dimension = dimension || _default;\n      this.setSize(_dimension, _dimension);\n      return this;\n    },\n    this.getBound = function() {\n      return {\n        left: this.x,\n        top: this.y,\n        right: this.x + this.width,\n        bottom: this.y + this.height,\n        width: this.width,\n        height: this.height\n      };\n    },\n    this.setBound = function(x, y, width, height) {\n      return this.setLocation(x, y),\n      this.setSize(width, height),\n      this;\n    },\n    this.getDisplayBound = function() {\n      return {\n        left: this.x,\n        top: this.y,\n        right: this.x + this.width * this.scaleX,\n        bottom: this.y + this.height * this.scaleY\n      };\n    },\n    this.getDisplaySize = function() {\n      return {\n        width: this.width * this.scaleX,\n        height: this.height * this.scaleY\n      };\n    },\n    this.getPosition = function(pos) {\n      let location, bound = this.getBound();\n      return 'Top_Left' == pos ? location = {\n        x: bound.left,\n        y: bound.top\n      }: 'Top_Center' == pos ? location = {\n        x: this.cx,\n        y: bound.top\n      }: 'Top_Right' == pos ? location = {\n        x: bound.right,\n        y: bound.top\n      }: 'Middle_Left' == pos ? location = {\n        x: bound.left,\n        y: this.cy\n      }: 'Middle_Center' == pos ? location = {\n        x: this.cx,\n        y: this.cy\n      }: 'Middle_Right' == pos ? location = {\n        x: bound.right,\n        y: this.cy\n      }: 'Bottom_Left' == pos ? location = {\n        x: bound.left,\n        y: bound.bottom\n      }: 'Bottom_Center' == pos ? location = {\n        x: this.cx,\n        y: bound.bottom\n      }: 'Bottom_Right' == pos && (location = {\n        x: bound.right,\n        y: bound.bottom\n      }),\n      location;\n    };\n}\n\n/**\n *  交互式Element\n */\nfunction InteractiveElement() {\n  this.initialize = function() {\n    InteractiveElement.prototype.initialize.apply(this, arguments),\n      this.elementType = 'interactiveElement',\n      this.dragable = false,\n      this.selected = false,\n      this.showSelected = true,\n      this.selectedLocation = null,\n      this.isMouseOver = false;\n    let properties = 'dragable,selected,showSelected,isMouseOver'.split(',');\n    this.serializedProperties = this.serializedProperties.concat(properties);\n  },\n    this.initialize(),\n    this.paintSelected = function(ctx) {\n      false !== this.showSelected && (ctx.save(), ctx.beginPath(), ctx.strokeStyle = 'rgba(168,202,255, 0.9)', ctx.fillStyle = 'rgba(168,202,236,0.7)', ctx.rect( - this.width / 2 - 3, -this.height / 2 - 3, this.width + 6, this.height + 6), ctx.fill(), ctx.stroke(), ctx.closePath(), ctx.restore());\n    },\n    this.paintMouseover = function(ctx) {\n      return this.paintSelected(ctx);\n    },\n    this.isInBound = function(x, y) {\n      return x > this.x && x < this.x + this.width * Math.abs(this.scaleX) && y > this.y && y < this.y + this.height * Math.abs(this.scaleY);\n    },\n    this.selectedHandler = function() {\n      this.selected = true,\n      this.selectedLocation = {\n        x: this.x,\n        y: this.y\n      };\n    },\n    this.unselectedHandler = function() {\n      this.selected = false,\n      this.selectedLocation = null;\n    },\n    this.dbclickHandler = function(msg) {\n      this.dispatchEvent('dbclick', msg);\n    },\n    this.clickHandler = function(msg) {\n      this.dispatchEvent('click', msg);\n    },\n    this.mousedownHander = function(msg) {\n      this.dispatchEvent('mousedown', msg);\n    },\n    this.mouseupHandler = function(msg) {\n      this.dispatchEvent('mouseup', msg);\n    },\n    this.mouseoverHandler = function(msg) {\n      this.isMouseOver = true,\n      this.dispatchEvent('mouseover', msg);\n    },\n    this.mousemoveHandler = function(msg) {\n      this.dispatchEvent('mousemove', msg);\n    },\n    this.mouseoutHandler = function(msg) {\n      this.isMouseOver = false,\n      this.dispatchEvent('mouseout', msg);\n    },\n    this.mousedragHandler = function(msg) {\n      let x = this.selectedLocation.x + msg.dx,\n        y = this.selectedLocation.y + msg.dy;\n      this.setLocation(x, y),\n      this.dispatchEvent('mousedrag', msg);\n    },\n    this.addEventListener = function(topic, fn) {\n      let _self = this,\n        action = function(data) {\n          fn.call(_self, data);\n        };\n      return this.messageBus || (this.messageBus = new Util.MessageBus),\n      this.messageBus.subscribe(topic, action),\n      this;\n    },\n    this.dispatchEvent = function(topic, msg) {\n      return this.messageBus ? (this.messageBus.publish(topic, msg), this) : null;\n    },\n    this.removeEventListener = function(topic) {\n      this.messageBus.unsubscribe(topic);\n    },\n    this.removeAllEventListener = function() {\n      this.messageBus = new Util.MessageBus;\n    };\n  let topics = 'click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,touchstart,touchmove,touchend'.split(','),\n    self = this;\n  topics.forEach(function(topic) {\n    self[topic] = function(fn) {\n      null != fn ? this.addEventListener(topic, fn) : this.dispatchEvent(topic);\n    };\n  });\n}\n\n/**\n * 可编辑Element\n */\nfunction EditableElement() {\n  this.initialize = function() {\n    EditableElement.prototype.initialize.apply(this, arguments),\n      this.editAble = false,\n      this.selectedPoint = null;\n  },\n    this.getCtrlPosition = function(pos) {\n      let $x = 5, $y = 5, $pos = this.getPosition(pos);\n      return {\n        left: $pos.x - $x,\n        top: $pos.y - $y,\n        right: $pos.x + $x,\n        bottom: $pos.y + $y\n      };\n    },\n    this.selectedHandler = function(_stage) {\n      EditableElement.prototype.selectedHandler.apply(this, arguments),\n      this.selectedSize = {\n        width: this.width,\n        height: this.height\n      },\n      _stage.scene.mode == SceneMode.edit && (this.editAble = true);\n    },\n    this.unselectedHandler = function() {\n      EditableElement.prototype.unselectedHandler.apply(this, arguments),\n      this.selectedSize = null,\n      this.editAble = false;\n    };\n  let points = ['Top_Left', 'Top_Center', 'Top_Right', 'Middle_Left', 'Middle_Right', 'Bottom_Left', 'Bottom_Center', 'Bottom_Right'];\n  this.paintCtrl = function(ctx) {\n    if (false !== this.editAble) {\n      ctx.save();\n      for (let i = 0; i < points.length; i++) {\n        let ctrPos = this.getCtrlPosition(points[i]);\n        ctrPos.left -= this.cx,\n          ctrPos.right -= this.cx,\n          ctrPos.top -= this.cy,\n          ctrPos.bottom -= this.cy;\n        let $width = ctrPos.right - ctrPos.left,\n          $heith = ctrPos.bottom - ctrPos.top;\n        ctx.beginPath(),\n          ctx.strokeStyle = 'rgba(0,0,0,0.8)',\n          ctx.rect(ctrPos.left, ctrPos.top, $width, $heith),\n          ctx.stroke(),\n          ctx.closePath(),\n          ctx.beginPath(),\n          ctx.strokeStyle = 'rgba(255,255,255,0.3)',\n          ctx.rect(ctrPos.left + 1, ctrPos.top + 1, $width - 2, $heith - 2),\n          ctx.stroke(),\n          ctx.closePath();\n      }\n      ctx.restore();\n    }\n  },\n    this.isInBound = function(_left, _top) {\n      this.selectedPoint = null;\n      if (this.editAble === true) {\n        for (let i = 0; i < points.length; i++) {\n          let $ctrPos = this.getCtrlPosition(points[i]);\n          if (_left > $ctrPos.left && _left < $ctrPos.right && _top > $ctrPos.top && _top < $ctrPos.bottom) {\n            return this.selectedPoint = points[i],true;\n          }\n        }\n      }\n      return EditableElement.prototype.isInBound.apply(this, arguments);\n    },\n    this.mousedragHandler = function(msg) {\n      if (null == this.selectedPoint) {\n        let x = this.selectedLocation.x + msg.dx,\n          y = this.selectedLocation.y + msg.dy;\n        this.setLocation(x, y),\n        this.dispatchEvent('mousedrag', msg);\n      } else {\n        if ('Top_Left' == this.selectedPoint) {\n          let tlWidth = this.selectedSize.width - msg.dx,\n            tlHeight = this.selectedSize.height - msg.dy,\n            tlX = this.selectedLocation.x + msg.dx,\n            tlY = this.selectedLocation.y + msg.dy;\n          tlX < this.x + this.width && (this.x = tlX, this.width = tlWidth),\n          tlY < this.y + this.height && (this.y = tlY, this.height = tlHeight);\n        } else if ('Top_Center' == this.selectedPoint) {\n          let tcHeight = this.selectedSize.height - msg.dy,\n            tcY = this.selectedLocation.y + msg.dy;\n          tcY < this.y + this.height && (this.y = tcY, this.height = tcHeight);\n        } else if ('Top_Right' == this.selectedPoint) {\n          let trWidth = this.selectedSize.width + msg.dx,\n            trY = this.selectedLocation.y + msg.dy;\n          trY < this.y + this.height && (this.y = trY, this.height = this.selectedSize.height - msg.dy),\n          trWidth > 1 && (this.width = trWidth);\n        } else if ('Middle_Left' == this.selectedPoint) {\n          let mlWidth = this.selectedSize.width - msg.dx,\n            mlX = this.selectedLocation.x + msg.dx;\n          mlX < this.x + this.width && (this.x = mlX),\n          mlWidth > 1 && (this.width = mlWidth);\n        } else if ('Middle_Right' == this.selectedPoint) {\n          let mrWidth = this.selectedSize.width + msg.dx;\n          mrWidth > 1 && (this.width = mrWidth);\n        } else if ('Bottom_Left' == this.selectedPoint) {\n          let blWidth = this.selectedSize.width - msg.dx,\n            blX = this.selectedLocation.x + msg.dx;\n          blWidth > 1 && (this.x = blX, this.width = blWidth);\n          let blHeight = this.selectedSize.height + msg.dy;\n          blHeight > 1 && (this.height = blHeight);\n        } else if ('Bottom_Center' == this.selectedPoint) {\n          let bcHeight = this.selectedSize.height + msg.dy;\n          bcHeight > 1 && (this.height = bcHeight);\n        } else if ('Bottom_Right' == this.selectedPoint) {\n          let brWidth = this.selectedSize.width + msg.dx;\n          brWidth > 1 && (this.width = brWidth);\n          let brHeight = this.selectedSize.height + msg.dy;\n          brHeight > 1 && (this.height = brHeight);\n        }\n        this.dispatchEvent('resize', msg);\n      }\n    };\n}\nDisplayElement.prototype = new Element;\nObject.defineProperties(DisplayElement.prototype, {\n  cx: {\n    get: function() {\n      return this.x + this.width / 2;\n    },\n    set: function(value) {\n      this.x = value - this.width / 2;\n    }\n  },\n  cy: {\n    get: function() {\n      return this.y + this.height / 2;\n    },\n    set: function(value) {\n      this.y = value - this.height / 2;\n    }\n  }\n});\n\nInteractiveElement.prototype = new DisplayElement;\nEditableElement.prototype = new InteractiveElement;\n\n// 单独挂在 t 上\nmodule.exports = {\n  DisplayElement: DisplayElement,\n  InteractiveElement: InteractiveElement,\n  EditableElement: EditableElement\n};\n"]}