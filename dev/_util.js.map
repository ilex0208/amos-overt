{"version":3,"sources":["../src/_util.js"],"names":["targetCanvas","document","createElement","graphics","getContext","alarmImageCache","alarmDefaulOps","rgbR","rgbA","isFirefox","navigator","userAgent","indexOf","isIE","window","attachEvent","isChrome","toLowerCase","match","MessageBus","name","_self","messageMap","messageCount","subscribe","topic","action","actions","push","unsubscribe","publish","data","concurrency","f","length","bdata","setTimeout","getDistance","p1","p2","x","y","dx","dy","Math","sqrt","mouseCoords","ev","cloneEvent","pageX","clientX","body","scrollLeft","clientLeft","pageY","clientY","scrollTop","clientTop","getEventPosition","rotatePoint","bx","by","angle","hypotenuse","azimuth","atan2","cos","sin","rotatePoints","target","points","result","i","p","_foreach","datas","dur","n","doIt","_for","m","resultEvent","key","clone","isPointInRect","point","rect","_x","_y","_width","width","_height","height","isPointInLine","path1","path2","pathDis","path1_2_point","path2_2_point","abs","removeFromArray","arr","obj","tempObj","del","randomColor","floor","random","isIntsect","getProperties","val","toJson","stage","sceneProperties","split","eleProperties","frames","childs","sceneItem","j","eleItem","generateColor","ctx","img","rgba","rgbas","parseInt","rgbG","tmpW","tmpH","clearRect","drawImage","imgData","getImageData","dataIndex","putImageData","dataUrl","toDataURL","generateImageAlarm","alarmColor","imgSrc","src","alarmImg","Image","ex","console","log","changeColor","rgbB","changeColorByOpts","alarmOps","_alarmOps","Object","assign","genImageAlarm","genImageAlarmByOpts","alarmImgOps","_ops","getOffsetPosition","domEle","left","top","_top","_left","documentElement","clientRect","getBoundingClientRect","ownerDoc","ownerDocument","_body","_de","tempTop","tempLeft","self","pageYOffset","pageXOffset","offsetTop","offsetLeft","offsetParent","lineF","x1","y1","x2","y2","tmpYdividedX","tmpY","CalcLine","num","k","b","inRange","range","num1","num2","minus","rangeNum1","rangeNum2","isPointInLineSeg","xRange","yRange","intersection","calcLine1","calcLine2","$x","$y","intersectionLineBound","calcLine","bound","tempCalcLine","bottom","resultBound","right","requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","oRequestAnimationFrame","callback","element","Array","prototype","tar","targetObj","slice","concat","msg","info","debug","warn","error","module","exports"],"mappings":"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","file":"_util.js","sourcesContent":["//////////////////////////////\n/**\n * util\n * @author ilex\n */\n//////////////////////////////\nlet targetCanvas = document.createElement('canvas'),\n  graphics = targetCanvas.getContext('2d'),\n  alarmImageCache = {};\nconst alarmDefaulOps = {\n  rgbR: 255,\n  rgbA: 255\n};\n\nlet isFirefox = navigator.userAgent.indexOf('Firefox') > 0;\nlet isIE = !(!window.attachEvent || -1 !== navigator.userAgent.indexOf('Opera'));\nlet isChrome = null != navigator.userAgent.toLowerCase().match(/chrome/);\n\n/**\n * 消息器\n *\n * @param {any} name\n */\nfunction MessageBus(name) {\n  let _self = this;\n  this.name = name,\n    this.messageMap = {},\n    this.messageCount = 0,\n    this.subscribe = function(topic, action) {\n      let actions = _self.messageMap[topic];\n      null == actions && (_self.messageMap[topic] = []),\n        _self.messageMap[topic].push(action),\n        _self.messageCount++;\n    },\n    this.unsubscribe = function(topic) {\n      let actions = _self.messageMap[topic];\n      if (actions && null != actions) {\n        _self.messageMap[topic] = null;\n        delete _self.messageMap[topic];\n        _self.messageCount--;\n      }\n    },\n    this.publish = function(topic, data, concurrency) {\n      let actions = _self.messageMap[topic];\n      if (null != actions) {\n        for (let f = 0; f < actions.length; f++) {\n          concurrency ? ! function(action, bdata) {\n            setTimeout(function() {\n              action(bdata);\n            },\n              10);\n          } (actions[f], data) : actions[f](data);\n        }\n      }\n    };\n}\n\n/**\n * 获取两个节点之间的距离\n *\n * @param {any} p1 node节点 / 第一个节点x\n * @param {any} p2 node节点 / 第一个节点y\n * @param {any} x 第二个节点x\n * @param {any} y 第二个节点y\n * @returns\n */\nfunction getDistance(p1, p2, x, y) {\n  let dx, dy;\n  return null == x && null == y ? (dx = p2.x - p1.x, dy = p2.y - p1.y) : (dx = x - p1, dy = y - p2),\n    Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * 获取鼠标坐标,返回事件本身\n *\n * @param {any} ev\n * @returns\n */\nfunction mouseCoords(ev) {\n  return ev = cloneEvent(ev),\n    ev.pageX || (ev.pageX = ev.clientX + document.body.scrollLeft - document.body.clientLeft, ev.pageY = ev.clientY + document.body.scrollTop - document.body.clientTop),\n    ev;\n}\n\n/**\n * 获取事件点\n *\n * @param {any} ev\n * @returns\n */\nfunction getEventPosition(ev) {\n  return ev = mouseCoords(ev);\n}\n\n/**\n * 旋转点\n *\n * @param {any} bx\n * @param {any} by\n * @param {any} x\n * @param {any} y\n * @param {any} angle\n * @returns\n */\nfunction rotatePoint(bx, by, x, y, angle) {\n  let dx = x - bx;\n  let dy = y - by;\n  // 获取直角三角形的斜边\n  let hypotenuse = Math.sqrt(dx * dx + dy * dy);\n  // 方位角加上旋转角度(弧度)\n  let azimuth = Math.atan2(dy, dx) + angle;\n  return {\n    x: bx + Math.cos(azimuth) * hypotenuse,\n    y: by + Math.sin(azimuth) * hypotenuse\n  };\n}\n\n/**\n * 旋转点集合\n *\n * @param {any} target\n * @param {any} points\n * @param {any} angle\n * @returns\n */\nfunction rotatePoints(target, points, angle) {\n  let result = [];\n  for (let i = 0; i < points.length; i++) {\n    let p = rotatePoint(target.x, target.y, points[i].x, points[i].y, angle);\n    result.push(p);\n  }\n  return result;\n}\n\n/**\n * 封装循环\n *\n * @param {any} datas\n * @param {any} f\n * @param {any} dur 执行间隔时间\n * @returns\n */\nfunction _foreach(datas, f, dur) {\n  if (datas.length == 0) {\n    return;\n  }\n  let n = 0;\n  function doIt(n) {\n    if (n == datas.length) {\n      return;\n    }\n    f(datas[n]);\n    setTimeout(function() {\n      doIt(++n);\n    }, dur);\n  }\n  doIt(n);\n}\n\nfunction _for(i, m, f, dur) {\n  if (m < i) {\n    return;\n  }\n  let n = 0;\n  function doIt(n) {\n    if (n == m) {\n      return;\n    }\n    f(m);\n    setTimeout(function() {\n      doIt(++n);\n    }, dur);\n  }\n  doIt(n);\n}\n\n/**\n * 克隆一个事件\n * (不可隆returnValue和keyLocation)\n *\n * @param {any} ev 待克隆事件\n * @returns\n */\nfunction cloneEvent(ev) {\n  let resultEvent = {};\n  for (let key in ev) {\n    'returnValue' != key && 'keyLocation' != key && (resultEvent[key] = ev[key]);\n  }\n  return resultEvent;\n}\n\n/**\n * 完全克隆一个事件\n *\n * @param {any} ev\n * @returns\n */\nfunction clone(ev) {\n  let resultEvent = {};\n  for (let key in ev) {\n    resultEvent[key] = ev[key];\n  }\n  return resultEvent;\n}\n\n/**\n * 判断点在矩形中\n *\n * @param {any} point\n * @param {any} rect\n * @returns\n */\nfunction isPointInRect(point, rect) {\n  let _x = rect.x,\n    _y = rect.y,\n    _width = rect.width,\n    _height = rect.height;\n  return point.x > _x && point.x < _x + _width && point.y > _y && point.y < _y + _height;\n}\n\n/**\n * 判断点在线上\n *\n * @param {any} point 点\n * @param {any} path1 连线1\n * @param {any} path2 连线2\n * @returns\n */\nfunction isPointInLine(point, path1, path2) {\n  let pathDis = getDistance(path1, path2),\n    path1_2_point = getDistance(path1, point),\n    path2_2_point = getDistance(path2, point),\n    result = Math.abs(path1_2_point + path2_2_point - pathDis) <= 0.5;\n  return result;\n}\n\n/**\n * 从数组中移除指定对象\n *\n * @param {any} arr\n * @param {any} obj\n * @returns 返回新的数组\n */\nfunction removeFromArray(arr, obj) {\n  for (let i = 0; i < arr.length; i++) {\n    let tempObj = arr[i];\n    if (tempObj === obj) {\n      arr = arr.del(i);\n      break;\n    }\n  }\n  return arr;\n}\n\n/**\n * 获取随机颜色\n *\n * @returns '[0到255], [0到255], [0到255]'\n */\nfunction randomColor() {\n  return Math.floor(255 * Math.random()) + ',' + Math.floor(255 * Math.random()) + ',' + Math.floor(255 * Math.random());\n}\n\nfunction isIntsect() { }\n\n/**\n * 获取属性\n *\n * @param {any} obj\n * @param {any} arr\n * @returns\n */\nfunction getProperties(obj, arr) {\n  let result = '';\n  for (let i = 0; i < arr.length; i++) {\n    if(i > 0){\n      result += ',';\n    }\n    let val = obj[arr[i]];\n    'string' == typeof val ? val = '\"' + val + '\"' : void 0 == val && (val = null),\n      result += arr[i] + ':' + val;\n  }\n  return result;\n}\n\n/**\n * 将stage中的所有元素转化成json\n *\n * @param {any} stage\n * @returns\n */\nfunction toJson(stage) {\n  let sceneProperties = 'backgroundColor,visible,mode,rotate,alpha,scaleX,scaleY,shadow,translateX,translateY,areaSelect,paintAll'.split(','),\n    eleProperties = 'text,elementType,x,y,width,height,visible,alpha,rotate,scaleX,scaleY,fillColor,shadow,transformAble,zIndex,dragable,selected,showSelected,font,fontColor,textPosition,textOffsetX,textOffsetY'.split(','),\n    result = '{';\n  result += 'frames:' + stage.frames,\n    result += ', scenes:[';\n  for (let i = 0; i < stage.childs.length; i++) {\n    let sceneItem = stage.childs[i];\n    result += '{',\n      result += getProperties(sceneItem, sceneProperties),\n      result += ', elements:[';\n    for (let j = 0; j < sceneItem.childs.length; j++) {\n      let eleItem = sceneItem.childs[j];\n      j > 0 && (result += ','),\n        result += '{',\n        result += getProperties(eleItem, eleProperties),\n        result += '}';\n    }\n    result += ']}';\n  }\n  result += ']'; // scenes结束符\n  result += '}';\n  return result;\n}\n\n/**\n * 构建颜色\n *\n * @param {any} ctx canvas绘图返对象,用于在画布上绘制图像(如：canvas.getContext('2D'))\n * @param {any} img image对象\n * @param {string} rgb 如:'255,255,0'\n * @returns\n */\nfunction generateColor(ctx, img, rgba) {\n  let rgbas = rgba.split(','),\n    rgbR = parseInt(rgbas[0]),\n    rgbG = parseInt(rgbas[1]),\n    rgbA = parseInt(rgbas[2]);\n  // 采用连续赋值,将img.width赋值给canvas,接着再将canvas.width赋值给临时变量tempW（此处不可拆开）\n  let tmpW = targetCanvas.width = img.width,\n    tmpH = targetCanvas.height = img.height;\n  ctx.clearRect(0, 0, targetCanvas.width, targetCanvas.height),\n    ctx.drawImage(img, 0, 0);\n  // 返回 ImageData 对象，该对象为画布上指定的矩形复制像素数据\n  let imgData = ctx.getImageData(0, 0, img.width, img.height);\n  // 返回Uint8ClampedArray, RGBA, 0到255\n  let data = imgData.data;\n  for (let i = 0; i < tmpW; i++) {\n    for (let j = 0; j < tmpH; j++) {\n      // 构建数据索引:imagedata读取的像素数据存储在data属性里，是从上到下，从左到右的，每个像素需要占用4位数据，分别是r,g,b,alpha透明通道\n      let dataIndex = 4 * (i + j * tmpW);\n      0 != data[dataIndex + 3] && (\n        null != rgbR && (data[dataIndex + 0] += rgbR),\n        null != rgbG && (data[dataIndex + 1] += rgbG),\n        null != rgbA && (data[dataIndex + 2] += rgbA)\n      );\n    }\n  }\n  ctx.putImageData(imgData, 0, 0, 0, 0, img.width, img.height);\n  let dataUrl = targetCanvas.toDataURL();\n  return dataUrl;\n}\n  // function genImageAlarm(a, b) {\n  //   var c = a.src + b;\n  //   if (alarmImageCache[c]) return alarmImageCache[c];\n  //   var d = new Image;\n  //   return d.src = changeColor(graphics, a, b),\n  //   alarmImageCache[c] = d,\n  //   d\n  // }\n/**\n * 构建告警image\n *\n * @param {any} image\n * @param {number} rgb\n * @returns\n */\nfunction generateImageAlarm(img, alarmColor) {\n  let imgSrc = img.src + alarmColor;\n  try {\n    if (alarmImageCache[imgSrc]) {\n      return alarmImageCache[imgSrc];\n    }\n    else\n    {\n      let alarmImg = new Image;\n      alarmImg.src = generateColor(graphics, img, alarmColor);\n      alarmImageCache[imgSrc] = alarmImg;\n      return alarmImg;\n    }\n  } catch (ex) {\n    console.log('genImageAlarm error|@', ex);\n  }\n  return null;\n}\n\n/**\n * 构建颜色\n *\n * @param {any} ctx canvas绘图返对象,用于在画布上绘制图像(如：canvas.getContext('2D'))\n * @param {any} img image对象\n * @param {number} rgbR integer values between 0 and 255 (included)\n * @param {any} rgbG\n * @param {any} rgbB\n * @param {any} rgbA alpha 0~255\n * @returns\n */\nfunction changeColor(ctx, img, rgbR, rgbG, rgbB, rgbA) {\n  // 采用连续赋值,将img.width赋值给canvas,接着再将canvas.width赋值给临时变量tempW（此处不可拆开）\n  let tmpW = targetCanvas.width = img.width,\n    tmpH = targetCanvas.height = img.height;\n  ctx.clearRect(0, 0, targetCanvas.width, targetCanvas.height),\n    ctx.drawImage(img, 0, 0);\n  // 返回 ImageData 对象，该对象为画布上指定的矩形复制像素数据\n  let imgData = ctx.getImageData(0, 0, img.width, img.height);\n  // 返回Uint8ClampedArray, RGBA, 0到255\n  let data = imgData.data;\n  for (let i = 0; i < tmpW; i++) {\n    for (let j = 0; j < tmpH; j++) {\n      // 构建数据索引:imagedata读取的像素数据存储在data属性里，是从上到下，从左到右的，每个像素需要占用4位数据，分别是r,g,b,alpha透明通道\n      let dataIndex = 4 * (i + j * tmpW);\n      if(0 != data[dataIndex + 3]){\n        null != rgbR && (data[dataIndex + 0] += rgbR);\n        null != rgbG && (data[dataIndex + 1] += rgbG);\n        null != rgbB && (data[dataIndex + 2] += rgbB);\n      }\n      // 0 != data[dataIndex + 3] && (null != rgbData && (data[dataIndex + 0] += rgbData), null != d && (data[dataIndex + 1] += d), null != e && (data[dataIndex + 2] += e));\n    }\n  }\n  ctx.putImageData(imgData, 0, 0, 0, 0, img.width, img.height);\n  let dataUrl = targetCanvas.toDataURL();\n  return alarmImageCache[img.src] = dataUrl, dataUrl;\n}\n\n/**\n * 通过具体的属性构建颜色\n *\n * @param {any} ctx canvas绘图返对象,用于在画布上绘制图像(如：canvas.getContext('2D'))\n * @param {any} img image对象\n * @param {number} rgbR integer values between 0 and 255 (included)\n * @param {any} rgbG\n * @param {any} rgbB\n * @param {any} rgbA alpha 0~255\n * @returns\n */\nfunction changeColorByOpts(ctx, img, alarmOps) {\n  let _alarmOps = Object.assign(alarmDefaulOps, alarmOps);\n  let rgbR = _alarmOps.rgbR;\n  let rgbG = _alarmOps.rgbG;\n  let rgbB = _alarmOps.rgbB;\n  let rgbA = _alarmOps.rgbA;\n  targetCanvas.width = img.width,\n  targetCanvas.height = img.height;\n  ctx.clearRect(0, 0, targetCanvas.width, targetCanvas.height),\n    ctx.drawImage(img, 0, 0);\n  // 返回 ImageData 对象，该对象为画布上指定的矩形复制像素数据\n  let imgData = ctx.getImageData(0, 0, img.width, img.height);\n  // 返回Uint8ClampedArray, RGBA, 0到255\n  let data = imgData.data;\n  for (var i = 0; i < data.length; i += 4)\n  {\n    if(data[i + 3] != 0){\n      null != rgbR && (data[i + 0] += rgbR);// R - 红色（0-255）\n      null != rgbG && (data[i + 1] += rgbG);// G - 绿色（0-255）\n      null != rgbB && (data[i + 2] += rgbB);// B - 蓝色（0-255）\n      data[i + 3] = rgbA;// A - alpha 通道（0-255; 0 是透明的，255 是完全可见的）\n    }\n  }\n  ctx.putImageData(imgData, 0, 0, 0, 0, img.width, img.height);\n  let dataUrl = targetCanvas.toDataURL();\n  return alarmImageCache[img.src] = dataUrl, dataUrl;\n}\n\n/**\n * 构建告警image\n *\n * @param {any} image\n * @param {number} rgbR RGBA 各个取值\n * @returns\n */\nfunction genImageAlarm(img, rgbR) {\n  rgbR = rgbR || 255;\n  try {\n    if (alarmImageCache[img.src]) {\n      return alarmImageCache[img.src];\n    }\n    else\n    {\n      let alarmImg = new Image;\n      alarmImg.src = changeColor(graphics, img, rgbR);\n      alarmImageCache[img.src] = alarmImg;\n      return alarmImg;\n    }\n  } catch (ex) {\n    console.log('genImageAlarm error|@', ex);\n  }\n  return null;\n}\n\n/**\n * 构建告警image\n *\n * @param {any} image\n * @param {Object} alarmImgOps RGBA 各个取值\n * @returns\n */\nfunction genImageAlarmByOpts(img, alarmImgOps) {\n  let _ops = Object.assign(alarmDefaulOps, alarmImgOps);\n  try {\n    if (alarmImageCache[img.src]) {\n      return alarmImageCache[img.src];\n    }\n    else\n    {\n      let alarmImg = new Image;\n      alarmImg.src = changeColorByOpts(graphics, img, _ops.rgbR);\n      alarmImageCache[img.src] = alarmImg;\n      return alarmImg;\n    }\n  } catch (ex) {\n    console.log('genImageAlarmByOpts error|@', ex);\n  }\n  return null;\n}\n\n/**\n * 获取偏移位置\n *\n * @param {any} domEle dom元素\n * @returns\n */\nfunction getOffsetPosition(domEle) {\n  if (!domEle) {\n    return {\n      left: 0,\n      top: 0\n    };\n  }\n  let _top = 0, _left = 0;\n  if ('getBoundingClientRect' in document.documentElement) {\n    let clientRect = domEle.getBoundingClientRect(),\n      ownerDoc = domEle.ownerDocument,\n      _body = ownerDoc.body,\n      _de = ownerDoc.documentElement,\n      tempTop = _de.clientTop || _body.clientTop || 0,\n      tempLeft = _de.clientLeft || _body.clientLeft || 0;\n    _top = clientRect.top + (self.pageYOffset || _de && _de.scrollTop || _body.scrollTop) - tempTop,\n      _left = clientRect.left + (self.pageXOffset || _de && _de.scrollLeft || _body.scrollLeft) - tempLeft;\n  } else {\n    do {\n      _top += domEle.offsetTop || 0,\n        _left += domEle.offsetLeft || 0,\n        domEle = domEle.offsetParent;\n    }\n    while (domEle);\n  }\n  return {\n    left: _left,\n    top: _top\n  };\n}\n\n/**\n * 获取Line\n *\n * @param {any} x1\n * @param {any} y1\n * @param {any} x2\n * @param {any} y2\n * @returns\n */\nfunction lineF(x1, y1, x2, y2) {\n  let tmpYdividedX = (y2 - y1) / (x2 - x1),\n    tmpY = y1 - x1 * tmpYdividedX;\n  /**\n   * 内置对象\n   *\n   * @param {any} num\n   * @returns\n   */\n  function CalcLine(num) {\n    return num * tmpYdividedX + tmpY;\n  }\n  CalcLine.k = tmpYdividedX,\n    CalcLine.b = tmpY,\n    CalcLine.x1 = x1,\n    CalcLine.x2 = x2,\n    CalcLine.y1 = y1,\n    CalcLine.y2 = y2;\n  return CalcLine;\n}\n\n/**\n * 判断在范围\n *\n * @param {number} range 范围\n * @param {number} num1\n * @param {number} num2\n * @returns\n */\nfunction inRange(range, num1, num2) {\n  let minus = Math.abs(num1 - num2),\n    rangeNum1 = Math.abs(num1 - range),\n    rangeNum2 = Math.abs(num2 - range),\n    result = Math.abs(minus - (rangeNum1 + rangeNum2));\n  return 1e-6 > result ? true : false;\n}\n\n/**\n * 判断点在线的有效范围内\n *\n * @param {number} xRange x范围\n * @param {number} yRange y范围\n * @param {Object} point\n * @returns\n */\nfunction isPointInLineSeg(xRange, yRange, point) {\n  return inRange(xRange, point.x1, point.x2) && inRange(yRange, point.y1, point.y2);\n}\n\n/**\n * 获取交叉点\n *\n * @param {any} a\n * @param {any} b\n * @returns\n */\nfunction intersection(calcLine1, calcLine2) {\n  let $x, $y;\n  return calcLine1.k == calcLine2.k ?\n    null\n    :\n    (\n      1 / 0 == calcLine1.k || calcLine1.k == -1 / 0 ?\n      ($x = calcLine1.x1,$y = calcLine2(calcLine1.x1))\n      :\n      1 / 0 == calcLine2.k || calcLine2.k == -1 / 0 ?\n      ($x = calcLine2.x1,$y = calcLine1(calcLine2.x1))\n      :\n      ($x = (calcLine2.b - calcLine1.b) / (calcLine1.k - calcLine2.k), $y = calcLine1($x)),\n      0 == isPointInLineSeg($x, $y, calcLine1) ?\n      null\n      :\n      0 == isPointInLineSeg($x, $y, calcLine2) ?\n      null\n      :\n      {x: $x, y: $y}\n  );\n}\n\n/**\n * 获取交叉线的bound\n *\n * @param {any} calcLine lineF返回的CalcLine对象\n * @param {any} bound\n * @returns\n */\nfunction intersectionLineBound(calcLine, bound) {\n  // 临时CalcLine\n  let tempCalcLine = lineF(bound.left, bound.top, bound.left, bound.bottom);\n  // 交叉点\n  let resultBound = intersection(calcLine, tempCalcLine);\n  return null == resultBound && (\n    tempCalcLine = lineF(bound.left, bound.top, bound.right, bound.top),\n    resultBound = intersection(calcLine, tempCalcLine),\n    null == resultBound && (\n      tempCalcLine = lineF(bound.right, bound.top, bound.right, bound.bottom),\n      resultBound = intersection(calcLine, tempCalcLine),\n      null == resultBound && (\n        tempCalcLine = lineF(bound.left, bound.bottom, bound.right, bound.bottom),\n        resultBound = intersection(calcLine, tempCalcLine)\n      )\n    )\n  ),\n    resultBound;\n}\n\n// requestAnim shim layer by ilex\nrequestAnimationFrame = (function(){\n  return  window.requestAnimationFrame ||\n          window.mozRequestAnimationFrame ||\n          window.webkitRequestAnimationFrame ||\n          window.msRequestAnimationFrame ||\n          window.oRequestAnimationFrame  ||\n          function(/* function */ callback, /* DOMElement */ element){\n            window.setTimeout(callback, 1000 / 24);\n          };\n})();\n// 使用方式\n// function animate() {\n//     requestAnimFrame(animate);\n//     draw();\n// }\n\n// requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame ||\n//   function(callback) {\n//     setTimeout(callback, 1000 / 24);\n//   };\n\n// 对requestAnimationFrame更牢靠的封装\n// (function() {\n//   var lastTime = 0;\n//   var vendors = ['moz','webkit', 'ms', 'o'];\n//   for(var i = 0; i < vendors.length && !window.requestAnimationFrame; i++) {\n//     window.requestAnimationFrame = window[vendors[i]+'RequestAnimationFrame'];\n//     window.cancelAnimationFrame = window[vendors[i]+'CancelAnimationFrame'] || window[vendors[i]+'CancelRequestAnimationFrame'];\n//   }\n//   if (!window.requestAnimationFrame){\n//     window.requestAnimationFrame = function(callback, element) {\n//       var currTime = new Date().getTime();\n//       var timeToCall = Math.max(0, 16 - (currTime - lastTime));\n//       var id = window.setTimeout(function() {\n//         callback(currTime + timeToCall);\n//       }, timeToCall);\n//       lastTime = currTime + timeToCall;\n//       return id;\n//     };\n//   }\n\n//   if (!window.cancelAnimationFrame){\n//     window.cancelAnimationFrame = function(id) {\n//       clearTimeout(id);\n//     };\n//   }\n// }());\n/**\n * 扩展array方法,添加del\n * @param {any} tar 需要删除的目标索引或者目标值\n */\nArray.prototype.del = function(tar) {\n  if (typeof targetObj != 'number') {\n    for (let i = 0; i < this.length; i++) {\n      if (this[i] === tar) {\n        return this.slice(0, i).concat(this.slice(i + 1, this.length));\n      }\n    }\n    return this;\n  } else {\n    if (tar < 0) {\n      return this;\n    }\n    return this.slice(0, tar).concat(this.slice(tar + 1, this.length));\n  }\n};\n\n/**\n * 给不支持indexOf方法的环境添加indexOf\n * 用于返回指定数据的索引\n */\nif (![].indexOf) { //IE\n  Array.prototype.indexOf = function(data) {\n    for (let i = 0; i < this.length; i++) {\n      if (this[i] === data) {\n        return i;\n      }\n    }\n    return -1;\n  };\n}\n\n/**\n * 给不支持console的环境添加\n */\nif (!window.console) { //IE\n  window.console = {\n    log: function(msg) { },\n    info: function(msg) { },\n    debug: function(msg) { },\n    warn: function(msg) { },\n    error: function(msg) { }\n  };\n}\n\nmodule.exports = {\n  MessageBus: MessageBus,\n  rotatePoint: rotatePoint,\n  rotatePoints: rotatePoints,\n  getDistance: getDistance,\n  getEventPosition: getEventPosition,\n  mouseCoords: mouseCoords,\n  isFirefox: isFirefox,\n  isIE: isIE,\n  isChrome: isChrome,\n  clone: clone,\n  isPointInRect: isPointInRect,\n  isPointInLine: isPointInLine,\n  removeFromArray: removeFromArray,\n  cloneEvent: cloneEvent,\n  randomColor: randomColor,\n  isIntsect: isIntsect,\n  toJson: toJson,\n  genImageAlarm: genImageAlarm,\n  genImageAlarmByOpts: genImageAlarmByOpts,\n  generateImageAlarm: generateImageAlarm,\n  getOffsetPosition: getOffsetPosition,\n  lineF: lineF,\n  intersection: intersection,\n  intersectionLineBound: intersectionLineBound,\n  _foreach: _foreach,\n  _for: _for\n};\n"]}